(function(){try{(function(){var n={L_AddCollection_Title:"Membuat Koleksi",L_AddToCollection_Title:"Tambahkan ke Tempat Saya",L_Collection_Empty_Message:"Untuk ditambahkan ke Koleksi Anda, ketuk Simpan dari salah satu hasil pencarian Anda.",L_MyPlaces_Title:"Tempat Saya",L_MyCollections_BackButton:"Koleksi Saya",L_BackToCollections_BackButton:"Kembali Ke Koleksi",L_SignIn_Text:"<link>Masuk<\/link> dengan akun Microsoft Anda untuk melihat Tempat Anda.",L_AddCollection_Text:"Koleksi Baru",L_AddCollection_Description:"Membuat koleksi baru yang dipersonalisasi",L_EditModeDone_Text:"Selesai",L_EditMode_Text:"Edit",L_CancelButton_Text:"Batal",L_CreateButton_Text:"Buat baru",SignInAndSaveButton:"Masuk dan Simpan",SignInTip:"<link>Masuk<\/link> untuk menyimpan",TempCollectionTip:"Lihat koleksi sementara Anda, atau buat yang baru.",EmptyTempCollectionLine1:"Koleksi sementara Anda kosong.",EmptyTempCollectionLine2:"Simpan tempat ke koleksi sementara Anda dari hasil pencarian Anda di peta. Cukup ketuk ",L_CreateCollection_ToolTip:"Membuat Koleksi",L_DeleteCollection_ToolTip:"Hapus Koleksi ini",L_DeleteItinerary_ToolTip:"Hapus Itinerari ini",L_DeleteEntity_ToolTip:"Hapus tempat ini",L_EnterEdit_ToolTip:"Edit Tempat Saya",L_ExitEdit_ToolTip:"Keluar dari mode edit",L_FailedEntitySave_Text:"Terjadi kesalahan saat menambahkan tempat ini ke Koleksi Anda Coba lagi.",L_NewCollectionDescription_Text:"Deskripsi",L_NewCollectionDescription_Watermark:"Contoh: Tempat untuk dikunjungi dalam trip saya",L_NewCollectionName_Text:"Nama",L_NewCollectionName_Watermark:"Contoh: Trip musim panas saya",L_NewCollectionPrivacy_Text:"Izinkan berbagi",L_CollectionError_Adding_Text:"Terjadi kesalahan saat membuat Koleksi. Coba lagi.",L_CollectionError_Deleting_Text:"Terjadi kesalahan saat menghapus Koleksi atau tempat. Coba lagi.",L_ItineraryError_Deleting_Text:"Terjadi kesalahan saat menghapus Itinerari. Silakan coba lagi.",L_CollectionError_Retrieving_Text:"Terjadi kesalahan saat menampilkan Koleksi Anda. Silakan coba lagi.",L_ItineraryError_Retrieving_Text:"Ada masalah saat menampilkan itinerari Anda. Silakan coba lagi.",L_CollectionError_Updating_Text:"Terjadi kesalahan saat menyimpan perubahan Anda pada Koleksi. Coba lagi.",L_CollectionError_SaveToExisting:"Terjadi kesalahan menyimpan tempat-tempat ini ke koleksi Anda. Coba lagi.",L_CollectionNameMissing_Text:"Jangan lupa untuk memberi nama Koleksi Anda.",L_DragToolTip_Text:"Seret untuk menyusun ulang",L_CollectionError_ViewShared_Text:"Kami tidak dapat menampilkan koleksi ini. Periksa koneksi jaringan Anda, atau tanyakan kepada orang yang membagikannya untuk memastikan berbagi diperbolehkan.",L_DescLengthError_Text:"Coba dengan deskripsi yang lebih singkat. (Maksimum 1000 karakter)",L_TitleLengthError_Text:"Coba nama yang lebih pendek. (Maksimum 100 karakter)",L_Collections_MyLocation:"Lokasi saya",L_FavoriteDirections_Text:"Dapatkan Arahan",L_RouteAll_Text:"Semua tempat saya",L_RouteSelectMessage_Text:"Pilih tempat dan ketuk Dapatkan Arahan",L_RouteSelect_Text:"Pilih tempat",L_SeeAllButton:"Lihat semua dalam tampilan peta",L_CollectionDirectionButton_Text:"Petunjuk Arah",L_CollectionDirectionButton_ToolTip:"Pilih rutekan semua atau pilih destinasi",L_CollectionEditButton_ToolTip:"Klik untuk mengedit judul atau deskripsi koleksi ini",L_CollectionShareButton_Text:"Bagikan",L_CollectionShareButton_ToolTip:"Klik untuk berbagi koleksi ini",L_CollectionSaveButton_ToolTip:"Klik untuk menyimpan ke koleksi",L_AddCollectionWhenNone_Text:"Tambahkan ke Koleksi Anda dengan mengetuk tombol Koleksi Baru.",L_DirectionsCancelToolTip_Text:"Batalkan memilih rute",L_GetDirectionsToolTip_Text:"Dapatkan Petunjuk Arah untuk tempat yang dipilih",L_MakePublicFail_Text:"Sistem kami tidak dapat membagikan Koleksi ini sekarang. Silakan coba lagi.",L_MakePublicSuccess_Text:'Anda mengubah Koleksi "{0}" dari mode privat ke berbagi.',L_UndoFail_Text:"Sistem kami tidak dapat membatalkan perubahan saat ini. Silakan coba lagi.",L_Undo_Text:"Batalkan",L_ShareOnlySpecificCollection_Text:"Tidak dapat berbagi kartu Tempat Saya ini. Coba bagikan koleksi tunggal.",L_CollectionDescriptionEdit_Text:"Anda dapat menambahkan deskripsi atau catatan di sini (maksimum 1000 karakter)",L_EnterEditText_ToolTip:"Edit judul atau deskripsi",L_FavoriteTitle_Text:"Favorit",L_KeyPlacesTitle_Text:"Tempat Utama",L_HomeFavorite_Text:"Beranda",L_WorkFavorite_Text:"Tempat Kerja",L_MissingHomeFavorite_Text:"Klik atau ketuk untuk menambahkan Rumah Anda",L_MissingWorkFavorite_Text:"Klik atau ketuk untuk menambahkan Karya Anda",L_MissingHomeFavorite_Text_V2:"Tentukan alamat rumah",L_MissingWorkFavorite_Text_V2:"Set alamat kantor",L_SetAddress_WaterMark:"Ketik alamat Anda",L_CollectionSubTitle_Text:"Koleksi",L_ItinerariesSubTitle_Text:"Itinerari",L_AddFavoritesMessage_Text:"Daftar Favorit Anda kosong. Tambahkan tempat ke Favorit Anda dengan menekan Simpan di kartu pencarian",L_AddFavoritesMessage_Text_Line2:"Tambahkan tempat ke Favorit Anda dengan menekan ",SignedOutMyPlacesMessage:"Untuk melihat tempat yang disimpan, masuk dengan akun pribadi Anda",SignInInformationPopup:"Anda hanya bisa masuk menggunakan akun Microsoft pribadi Anda. Akun kantor dan sekolah saat ini tidak didukung.",L_SeeLess_Text:"Lihat Lebih Sedikit",L_SeeMore_Text:"Lihat Selengkapnya",L_SeeLess_ToolTip:"Lihat Lebih Sedikit {0} ",L_SeeMore_ToolTip:"Lihat Selengkapnya {0}",L_FavoriteErrorMessage_Text:"Kami tidak dapat memperoleh Favorit Anda dari penyimpanan",L_HomeEditText_ToolTip:"Buka edit dialog untuk Beranda",L_WorkEditText_ToolTip:"Buka edit dialog untuk Pekerjaan",L_AddHome_Text:"Tambahkan Rumah Anda",L_AddHome_Title:"Rumah",L_AddWork_Text:"Tambahkan Kantor Anda",L_AddWork_Title:"Pekerjaan",L_AddHomeWork_Button:"Tambahkan",L_CreateFavoriteError_AlreadyExists:"Kami tidak dapat menyimpan tempat ini, karena sudah ada di favorit Anda.",L_EditHome_Text:"Edit Rumah Anda",L_EditWork_Text:"Edit Tempat Kerja Anda",L_AllowLCAStatement_Text:"Mencentang kotak ini membolehkan Anda untuk membagikan koleksi ini melalui URL.",L_AutoSuggestSearchFailed_Message:'Tidak ditemukan "{0}"',L_FailedSaveFavorite_Message:"Terjadi kesalahan saat menyimpan tempat ini ke Favorit Anda. Coba lagi.",L_BackToDetails_Text:"Detail pencarian lokal",L_DeleteFavorite_ToolTip:"Hapus Favorit ini",L_DeleteHome_ToolTip:"Hapus ini sebagai Rumah Anda",L_DeleteWork_ToolTip:"Hapus dari Karya Anda",L_EditFavoriteText_ToolTip:"Edit Favorit ini",L_EditHomeText_ToolTip:"Edit Rumah Anda",L_EditWorkText_ToolTip:"Mengedit Pekerjaan Anda",L_PlaceTitleEditSuggestion_Text:"Beri nama tempat ini",L_PlaceAddressEditSuggestion_Text:"Berikan alamat pada tempat ini",L_PlaceDescriptionEditSuggestion_Text:"Tambahkan catatan",L_FormatDescription_Text:"{0}: {1}",L_CollectionCount_Text:"{0} item",L_CollectionCountSingle_Text:"{0} item",L_AddressLabel_Text:"Alamat",L_TitleLabel_Text:"Judul",L_AddHomeWorkSearch_Button:"Cari",L_ShowHomeWorkCheckbox:"Tampilkan tempat ini di peta saya",L_MaxDirectionsItems_Text:"Maksimum 25 titik arah yang diizinkan.",L_SignInButton_Text:"Masuk",L_PrintNotes_Watermark:"Ketik catatan Anda di sini.",L_SharedTemporaryCollection_Title:"Tempat yang Dibagikan",L_TemporaryCollectionTitle:"Koleksi Sementara",L_TemporaryCollectionDescription:"Tempat-tempat yang disimpan secara lokal di browser Anda",L_TemporaryCollectionSignIn:"Masuk untuk opsi penghematan lainnya dan untuk mengakses koleksi Anda dari mana saja.",L_TemporaryCollectionClearButton:"Bersihkan",L_TemporaryCollectionClearButton_Cardified:"Bersihkan koleksi sementara",L_TemporaryCollectionSaveButton:"Simpan",L_TemporaryCollectionRemoveButton:"Hapus",L_TemporaryCollectionDeleteConfirmationMessage:"Yakin ingin menghapus tempat ini?",L_CollectionsListDeleteConfirmationMessage:"Yakin ingin menghapus koleksi ini?",L_ItineraryDeleteConfirmationMessage:"Yakin ingin menghapus itinerari ini?",L_TemporaryCollectionClearConfirmationMessage:"Apakah Anda yakin ingin membersihkan semua tempat Anda?",L_TemporaryCollectionSaveMessage:"Simpan koleksi ini untuk mengaksesnya dari perangkat lain di akan datang. Simpan ke:",L_TemporaryCollectionSaveToNew:"Koleksi Baru",L_RemoveEntity_ToolTip:"Hapus tempat ini dari koleksi sementara",L_ContextMenu_ToolTip:"Tindakan tambahan pada entitas ini",L_MeasureMapTask_Title:"Ukur Jarak dan Area",L_MyContributions_Title:"Kontribusi Saya",SignedOutMyContributionsMessage:"Untuk melihat kontribusi Anda, masuk dengan akun pribadi Anda",EmptyMyContributionsMessage:"Anda tidak memiliki kontribusi apa pun.",MyContributionsNetworkErrorMessage:"Tak bisa memuat kontribusi Anda. Silakan coba lagi.",MyContributionsRetry:"Coba lagi",MyContributionDeleteNetworkErrorMessage:"Tak bisa menghapus kontribusi Anda. Silakan coba lagi.",MyContributionsOk:"OK",DeleteMyContributionsToolTip:"Hapus kontribusi ini",L_MeasureMapTask_InitialInstructions:"Klik atau ketuk peta untuk membuat titik baru. Ketuk dan seret titik yang sudah ada untuk memindahkannya. Klik kanan (atau ketuk dan tahan) pada titik untuk menghapusnya.",L_MeasureMapTask_PerimeterFormat:"Jarak: {primary} ({secondary})",L_MeasureMapTask_AreaFormat:"Area: {primary} ({secondary})",L_MeasureMapTask_NewLink_Text:"Atur ulang",L_MeasureMapTask_DoneLink_Text:"Selesai",L_MeasureMapTask_EditLink_Text:"Edit",L_MeasureMapTask_AreaLink_Text:"Tutup bentuk",L_MeasureMapTask_NewLink_Title:"Hapus bentuk saat ini dan memulai dari awal",L_MeasureMapTask_DoneLink_Title:"Selesai mengedit bentuk saat ini dan tinggalkan di peta",L_MeasureMapTask_EditLink_Title:"Lanjutkan mengedit bentuk saat ini",L_MeasureMapTask_AreaLink_Title:"Konversikan bentuk saat ini menjadi poligon dan tampilkan area yang terkandung",L_MeasureMapTask_DistanceUnitKm_Text:"Km",L_MeasureMapTask_DistanceUnitMeter_Text:"m",L_MeasureMapTask_DistanceUnitMile_Text:"mil",L_MeasureMapTask_DistanceUnitFoot_Text:"kaki",L_MeasureMapTask_AreaUnitKm_Text:"km persegi",L_MeasureMapTask_AreaUnitMeter_Text:"meter persegi",L_MeasureMapTask_AreaUnitMile_Text:"mil persegi",L_MeasureMapTask_AreaUnitFoot_Text:"kaki persegi",L_MeasureMapTask_ValueUnitFormat:"{value} {unit}",L_Migration_In_Progress_Message:"Pemeliharaan Server, silakan coba lagi dalam beberapa menit",L_User_Migrated_Message:"Pemeliharaan Server, silakan refresh browser Anda dan coba lagi",L_Max_Collections_Message:"Anda telah mencapai batas {0} di akun Anda. Untuk membuat koleksi baru, Anda harus menghapus satu atau beberapa koleksi yang ada.",L_Max_Entities_Message:"Anda telah mencapai batas {0} dalam koleksi ini. Untuk menambahkan tempat baru ke koleksi ini, Anda harus menghapus satu atau beberapa tempat yang sudah ada.",L_EditSaveButton:"Simpan",L_EditDoneButton:"Selesai",L_DeleteDoneButton:"Selesai",L_NicknameTitle:"Nama Panggilan",L_DescriptionTitle:"Deskripsi",L_CollectionPrivateMessage:"Publikasikan koleksi ini..",L_CollectionPublicMessage:"Jadikan koleksi ini privat.",L_CollectionMadePrivateMessage:"Koleksi ini sekarang bersifat pribadi dan tidak dapat dibagikan dengan orang lain.",L_CollectionMadePublicMessage:"Koleksi ini sekarang dapat dibagikan dengan orang lain.",L_AddCollectionPrivateMessage:"Koleksi ini tidak bisa dibagikan. Ketuk ikon gembok untuk membuat koleksi dapat dibagikan.",L_AddCollectionPublicMessage:"Anda dapat berbagi koleksi ini dengan orang lain. Ketuk ikon gembok untuk menjadikan koleksi privat.",L_UpcomingEventsName:"Acara Mendatang",L_UpcomingEventEntity_TimeLabelFormat:"{date} @ {time}",L_SeeMoreEventsLink:"Lihat lebih banyak acara mendatang",L_SeeLessEventsLink:"Lihat lebih sedikit acara akan datang",L_FlightToText:"Penerbangan ke {0}",L_EmptyItinerariesMessage:"Manfaatkan setiap hari - simpan itinerari Bing yang Anda sukai, atau sesuaikan dan buat sendiri.",L_EmptyItinerariesSearchLink1:'Cari untuk memulai (misalnya "',L_EmptyItinerariesSearchLink2:"Itinerari Seattle",L_EmptyItinerariesSearchLink3:'").',L_CreateNewItinerary:"Buat itinerari baru",SaveOnSerp_ConfirmationLink:"<link>Lihat Tempat Saya<\/link>",SaveOnSerp_SavedButtonText:"Tersimpan",SaveOnSerp_HoverTip:"Simpan ke Tempat Saya",L_AddNewCollection:"Tambahkan koleksi baru",L_AddNewItinerary:"Tambah itinerari baru",AutoCollections_LabeledPlaces:"Tempat Berlabel",AutoCollections_NearHome:"Tempat di dekat Rumah",AutoCollections_NearWork:"Tempat di dekat Kantor",AutoCollections_Nearby:"Tempat-tempat di dekat {0}",HowManyMoreAttractions:"+{0} lainnya",NumberOfAttractions:"{0} item",L_CollectionEdit:"Edit",L_CollectionRemoveButton:"Hapus",L_PlaceholderEmptyDescription:"Tambahkan deskripsi",L_PlaceholderEmptyName:"Tambahkan nama",L_MoreToolTip:"Lainnya",L_NewCollectionTitle:"Nama",L_EditCollectionButton:"Edit koleksi",L_DeleteCollectionButton:"Hapus koleksi",L_ConfirmCreateCollection:"konfirmasi pembuatan koleksi baru",L_CancelCreateCollection:"batal membuat koleksi baru",L_ConfirmDeleteCollection:"konfirmasi menghapus koleksi",L_CancelDeleteCollection:"batal menghapus koleksi",L_ConfirmEditCollection:"konfirmasi pengeditan koleksi",L_CancelEditCollection:"batal mengedit koleksi",L_EditCollectionTitle:"edit nama koleksi",L_ConfirmTitleEdit:"konfirmasi pengeditan judul",L_CancelTitleEdit:"batalkan pengeditan judul",L_ChangePrivacyStatus:"klik untuk mengubah status privasi",L_ConfirmCollectionEntityEdit:"konfirmasi edit entitas koleksi",L_CancelCollectionEntityEdit:"batalkan edit entitas koleksi",L_ConfirmCollectionEntityDelete:"konfirmasi penghapusan entitas koleksi",L_CancelCollectionEntityDelete:"batalkan penghapusan entitas koleksi",L_FavoriteEntryOnClickText:"klik untuk membuka entri favorit",L_HomeEntryOnClickText:"klik untuk membuka entri rumah",L_WorkEntryOnClickText:"klik untuk membuka entri kerja",L_CollectionOnClickText:"klik untuk membuka koleksi",L_ConfirmFavoriteEntityEdit:"konfirmasi pengeditan entitas favorit",L_CancelFavoriteEntityEdit:"batalkan edit entitas favorit",L_ConfirmFavoriteEntityDelete:"konfirmasi penghapusan entitas favorit",L_CancelFavoriteEntityDelete:"batal hapus entitas favorit",L_ConfirmHomeDelete:"konfirmasi hapus rumah",L_CancelHomeDelete:"batal hapus rumah",L_ConfirmWorkDelete:"konfirmasi penghapusan kantor",L_CancelWorkDelete:"batalkan penghapusan tempat kerja",L_ConfirmItineraryDelete:"konfirmasi penghapusan itinerari",L_CancelItineraryDelete:"batalkan penghapusan itinerary",L_ItineraryDeleteButton:"klik untuk menghapus itinerari",SortBy:"Urutkan dengan:",MostRecent:"Terkini",AtoZ:"A-Z",ZtoA:"Z-A",Custom:"Kustom",SetHomeWork_Watermark:"Masukkan lokasi",SetHome_Title:"Alamat Rumah",SetWork_Title:"Alamat Kantor",SetHome_Instructions:"Ketikkan alamat rumah Anda",SetWork_Instructions:"Ketik alamat tempat kerja Anda",Enter_Button:"Masukkan",L_AddressMetadataLine:"{0}, {1}",SuggestedCollections:"Koleksi yang Disarankan",TemporaryCollectionSaveButtonText:"Simpan Koleksi Sementara ini ke Koleksi Anda sendiri",ExploreTitleText:"Jelajahi dan simpan tempat-tempat terdekat",ExploreAttractionsText:"Atraksi",ExploreCoffeeShopsText:"Kedai Kopi",ExploreMallsText:"Mal",ExploreMuseumsText:"Museum",ExploreRestaurantsText:"Restoran",ExploreCitiesText:"Jelajahi daftar perjalanan kota teratas",ItinerariesQueryText:"{0} itinerari",NewCollectionConfirmationTitle:"Tersimpan",NewCollectionConfirmationText:"Lihat di <link>{0}<\/link>",NewCollectionConfirmationLabel:"Klik untuk membuka koleksi yang baru dibuat",PrivateCollectionIndicator:"Privat",PublicCollectionIndicator:"Umum",HomeSignInHint:"Masuk dan simpan alamat rumah Anda",WorkSignInHint:"Masuk dan simpan alamat kantor Anda",L_SignInMyContributions_Text:"<link>Masuk<\/link> dengan akun Microsoft Anda untuk melihat Kontribusi Anda.",L_MyContributionsDeleteConfirmationMessage:"Anda yakin ingin menghapus gambar ini?",L_DeletePhotoButton_Text:"Hapus Foto",EntityName_Other:"Lainnya",Connect:"Sambungkan",MicrosoftAccount:"Akun Microsoft",SignedOutMyContributionsText:"Untuk melihat kontribusi Anda, masuk dengan akun Anda.",WorkAccount:"Akun kerja atau sekolah",Accounts:"Akun",MC_SignInYourAccount:"Masuk ke akun Anda",MC_MyPhotos:"FOTO SAYA",MC_Overview:"GAMBARAN UMUM",MC_MyRewards_Intro:"Semakin banyak berkontribusi pada pengalaman pencarian lokal, semakin banyak pengakuan yang Anda dapatkan dengan mencapai tingkat yang lebih tinggi. Seiring dengan naiknya tingkatan, Anda akan mendapatkan hadiah Bing.",MC_MyContributionsInfo:"Dapatkan poin dengan menyumbangkan konten ke Bing. Untuk memperbarui info bisnis, Anda dapat menyarankan pengeditan, menambahkan foto, menjelaskan pengalaman Anda dengan ulasan, berbagi reaksi terhadap informasi yang diberikan, dan banyak lagi.",MC_MyRewards_More:"Pelajari selengkapnya tentang Poin kontribusi",MC_Amenities:"Fasilitas",MC_Approved:"DISETUJUI",MC_ApprovedTip:"Jumlah kiriman yang telah Anda bagikan dengan komunitas Microsoft Bing.",MC_Contribution:"KONTRIBUSI",MC_ContributionPointsEarned:"Poin kontribusi yang diperoleh",MC_ContributionStatus:"Status kontribusi",MC_EarnMicrosoftRewards:"DAPATKAN {0} MICROSOFT REWARDS!",MC_Level:"TINGKAT {0}",MC_NewEntity:"Entitas Baru",MC_Pending:"TERTUNDA",MC_PendingTip:"Jumlah kiriman yang Anda buat yang menunggu untuk ditinjau sebelum diterbitkan.",MC_PhotoReviewAspects:"Aspek ulasan foto",MC_PhotoUpload:"Unggahan foto",MC_PointsTo:"{0} poin menuju Tingkat {1}!",MC_PointsToGo:"{0} poin lagi!",MC_PointsEarned:"POIN YANG DIPEROLEH",MC_PointsEarnedTip:"Total poin yang telah Anda dapatkan untuk semua kiriman yang disetujui.",MC_Reaction:"Reaksi",MC_Review:"Ulasan (penuh)",MC_RewardPortal:"Portal Microsoft Rewards.",MC_RewardsIntro:"Untuk melacak saldo hadiah saat ini dan berpartisipasi dalam tantangan lokal untuk mendapatkan lebih banyak Microsoft Rewards, buka",MC_RewardsSignup:"Daftar ke Microsoft Rewards",MC_SuggestAnEdit:"Beri saran pengeditan",MC_TotalPointsEarned:"TOTAL POIN KONTRIBUSI YANG DIPEROLEH",MC_Welcome:"Selamat datang kembali, {0}!",MC_Close:"Tutup",MC_ContributionPoints:"Poin Kontribusi",MC_BingContribution:"KONTRIBUSI BING",MC_My_photos:"Foto saya",MC_TotalPointsEarned_S:"TOTAL POIN YANG DIPEROLEH",MC_ExpandStatusTable:"Luaskan tabel status",MC_OpenStatusTable:"Buka tabel status",MC_ProfilePicture:"Foto profil",MC_DisplayMyContributions:"Tampilkan kontribusi saya",MC_DisplayMyPhotos:"Tampilkan foto saya",MC_Overview_S:"Gambaran Umum",MC_OpenPointsTable:"Buka tabel poin kontribusi",L_AddItinerary_Text:"New Itinerary",L_AddItinerary_Description:"Create a new personalized travel itinerary"};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("Collections",n):window.$MicrosoftMaps8.ResourcesObject=n})(),function(){var n={Attribution:"Data dari:",GettyImageAttribution:"© {0} Getty Images",TravelGuide:"{0} Panduan Perjalanan",ItinTitleSingular:"Itinerari {0} {1} Hari",ItinTitlePlural:"Itinerari {0} {1} Hari",DayHeader:"Hari {0}",DaySingular:"{0} hari",DayPlural:"{0} hari",AddDay:"Tambahkan hari",Discover:"Temukan",AttractSingular:"{0} atraksi",AttractPlural:"{0} atraksi",BackToList:"kembali ke daftar",ItineraryShare_ToolTip:"Klik untuk berbagi itinerari ini",ItineraryDrag_ToolTip:"Seret untuk menyusun ulang",PrintNotesWaterMark:"Ketik catatan rute Anda di sini",PrintDay:"Hari {0}",DeleteDay:"Hapus hari ini",NicknameTitle:"Nama panggilan",DescriptionTitle:"Deskripsi",CancelButton_Text:"Batal",EditSaveButton:"Simpan",EditButton_ToolTip:"Edit Nama",SaveButton_ToolTip:"Simpan",ShareButton_ToolTip:"Bagikan",DeleteButton_ToolTip:"Hapus",ContextMenuButton_ToolTip:"Lainnya",NewItineraryDescription_Watermark:"Contoh: Liburan musim panas ke Paris",Add_Attractions:"Temukan atraksi",Attractions_Query:"{0} atraksi",Restaurants_Query:"{0} restoran",Hotels_Query:"{0} hotel",AddToDay_ToolTip:"{0} telah ditambahkan ke hari {1} dari <link>itinerari<\/link> Anda",AddToDayOfItinerary_ToolTip:"{0} telah ditambahkan ke hari {1} dari <link>{2}<\/link>",DeleteDay_ToolTip:"Satu hari telah dihapus dari itinerari Anda",AddDay_ToolTip:"Hari {0} telah ditambahkan ke itinerari Anda",DeleteItem_ToolTip:"{0} telah dihapus dari itinerari Anda.",MoveToDay_ToolTip:"{0} telah dipindahkan ke hari {1}",OperationFailed_ToolTip:"Operasi Gagal",ItinerarySaved_ToolTip:"Semua pengeditan yang Anda buat akan disimpan secara otomatis ke Tempat Saya.",SaveItinerary_ToolTip_Line1:"Simpan salinan - simpan pengeditan Anda",SaveItinerary_ToolTip_Line2:"Simpan salinan itinerari ini untuk melihat hasil editan Anda nanti.",SavedCopyName:"{0} - salin",L_SignInRequiredItinerary:"<link>Masuk<\/link> untuk menyimpan salinan",EmptyRecommendationsMessage:"Tidak ada rekomendasi yang tersedia untuk destinasi ini. ",EmptyRecommendationsMessageLink1:"Mencari",AttractionsSuggestionLink:"Atraksi",EmptyRecommendationsMessageLink2:", ",RestaurantsSuggestionLink:"restoran",EmptyRecommendationsMessageLink3:", ",HotelsSuggestionLink:"Hotel",EmptyRecommendationsMessageLink4:" dan lainnya untuk menemukan tempat untuk ditambahkan ke itinerari Anda.",EmptyDayMessage:" langsung dari hasil pencarian atau peta untuk disimpan ke itinerari Anda.",EmptyDaySuggestionLink1:"Selain dari ",EmptyDaySuggestionLink2:"Atraksi",EmptyDaySuggestionLink3:", Anda dapat menemukan ",EmptyDaySuggestionLink4:"restoran",EmptyDaySuggestionLink5:", ",EmptyDaySuggestionLink6:"Hotel",EmptyDaySuggestionLink7:", dan banyak lagi untuk ditambahkan ke itinerari Anda dengan mencarinya di peta.",L_DeleteDayConfirmationMessage:"Anda yakin ingin menghapus permanen hari ini?",L_ConfirmDeleteDayButton:"Hapus",L_CancelDeleteDayButton:"Batal",New_Itinerary_Title:"New Itinerary",New_Itinerary_Title_One_Destination:"{0} Itinerary",New_Itinerary_Title_Multiple_Destinations:"{0} - {1} Itinerary",Destinations_Title:"Where do you want to go?",Destinations_WaterMark:"City, State, National Park, etc.",Travel_Dates_CheckBox:"I know my dates",Add_Location:"Add location",Get_Started:"Get Started",Trip_Summary:"Trip summary",Destinations_Summary:"{0} (+{1})",Separator:" · ",Add_Dates_Hint:"Know your dates?",Edit_Destinations:"Edit",Directions_Not_Available:"Petunjuk arah tidak tersedia",ExploreMore:"Jelajahi lainnya",Highlights:"Sorotan",Attractions:"Atraksi",Coffee:"Kopi",Events:"Acara",Hotels:"Hotel",Restaurants:"Restoran",SaveItinerary:"Simpan Itinerari",Share:"Bagikan",Shopping:"Belanja",ApproxTime:"Approx: {0}",TotalDistance:"Total travel: {0}",Total:"Total: {0}",StartTime:"Start: {0}",DayExpand:"Expand to show day",DayCollapse:"Collapse to hide day",AverageVisitTime:"Avg visit time: {0}",Itineraries:"Itineraries",Closed:"Closed",ActivityClosedMessage:"This activity may be closed at this time.",BusyDayMessage:"Your day looks busy. You may want to reconsider moving a few activities to other days.",Delete_Day:"Delete day",EditStartTime:"Edit start time",MoveDayDown:"Move day down",MoveDayUp:"Move day up",L_Menu_ReportProblem_Link_Text:"Report a Problem",L_ReportMissingBusiness_Text:"Add a Missing Business",Overlay_NewErrorLink_Separator:"{0} or {1}",StayDuration:"{0} mins",DeleteItem:"Delete this attraction",searchHint:"Open search for {0} to add to your itinerary",newDayStartMessage:"You can add ",newDayEndMessage:", and more to this day."};window.$MicrosoftMaps8.ResourceManager?window.$MicrosoftMaps8.ResourceManager.init("Travel",n):window.$MicrosoftMaps8.ResourcesObject=n}();var r=window.$MicrosoftMaps8,h=r.Internal,yt=h.TaskData=h.TaskData||{},f=r.CloudGraphDataManager=r.CloudGraphDataManager||{},er=r.Anchor,or=r.CommonControls.AutosuggestV2,sr=r.CommonControls.AutosuggestViewModel,hr=h.BaseTask,cr=h.BaseTaskViewModel,lr=r.BitmapImageTemplate,pt=r.BasicTemplate,gt=yt.CollectionActions,ar=r.CommonControls.CollectionsAutosuggestDataModel,n=r.GlobalConfig.features.collections,vr=r.CollectionsTaskPoiManager,yr=r.Constants,pr=h.ControlTemplate,ni=r.DataHandlerKeys,e=r.Internal._Debug,wr=yt.DistanceUnit,hi=h._EntryPoints,br=h.GeolocationProvider,w=h._Gimme,et=r.GlobalConfig,ti=r.GlobalDataEventHandler,kr=r.ImageFromCssHelper,k=h._JSEvent,g=h._Helper,wt=h._LatLonCrs,d=h._LocalStorageCache,dr=r.LocationRect,gr=h.MapHelper,nu=r.MapLayer,l=r.Location,ft=r.MapMath,tu=r.MapTypeId,iu=r.MapView,ui=r.Module,ci=h._Network,ru=h._Observable,c=h._ObservableCollection,it=h._ObservableObject,uu=h._ObservableObjectChangedArgs,fu=h._OverlayEntity,eu=r.GlobalConfig.features.print,ou=h.PrintContent,su=h.PrintManager,a=r.ResourceManager.Collections,li=h.SaveOnSerpConfirmationTip,ai=r.SignInState,vi=r.SimplePointPrimitive,hu=r.TabControlRequester,ii=r.TaskTypes,cu=h.TransientLensActions,yi=yt.TravelAttractionEntity,lu=r.GlobalConfig.features.travel,pi=r.ResourceManager.Travel,fi=h.UserTipControl,au=r.VectorMapLayer,vu=yt.Waypoint,yu=r.ZoomLevel,wi='<div class="bm_newCollectionRoot cardified myPlacesV2 oneMap" data-tag="newCollectionRoot" event:click="onNameEditBoxClick">    <div class="titleEditEntryRow" data-tag="titleEditEntryRow" style:top="{Binding TopPosition}" style:right="{Binding RightPosition}" style:left="{Binding LeftPosition}">        <div class="newCollectionControlTitle">            <TextBlock Text="{Binding _isSavingTempCollection Converter=getTitleText}" />        <\/div>        <div class="editNicknameText">            <TextBlock Text="{Binding resources.L_NewCollectionTitle}" />        <\/div>        <input type="text" class="nameEditBox nameDescriptionWidth" data-tag="nameEditBox" maxlength="100" value="{Binding TempName Mode=TwoWay}" />        <div class="titleEditSpacingCollection"><\/div>        <div class="editDescriptionText">            <TextBlock Text="{Binding resources.L_DescriptionTitle}" />        <\/div>        <textarea class="descriptionEditBox nameDescriptionWidth" data-tag="descriptionEditBox" placeholder="{Binding resources.L_NewCollectionDescription_Watermark}" contenteditable="true" rows="4" maxlength="1000" value="{Binding TempDescription Mode=TwoWay}"><\/textarea>        <div class="editRowButtonContainer">            <a role="button" class="cancelEditButton commonButtonControl" data-tag="cancelEdit" event:click="onCancelTitleEditClick" href="#" aria-label="{Binding resources.L_CancelTitleEdit}">                <TextBlock Text="{Binding resources.L_CancelButton_Text}" />            <\/a>            <a role="button" class="confirmEditButton commonButtonControl" data-tag="confirmEdit" event:click="onConfirmTitleEditClick" href="#" aria-label="{Binding resources.L_ConfirmTitleEdit}">                <TextBlock Text="{Binding resources.L_EditModeDone_Text}" />            <\/a>        <\/div>    <\/div><\/div>',bi='<div role="dialog" aria-labelledby="tipTitle" class="{TemplateBinding IsFaded Converter=boolToFadedClass}" data-tag="UserTip" style:display="{TemplateBinding IsHidden Converter=boolToNotDisplay}" event:mouseenter="onTipHoverOver" event:mouseleave="onTipHoverOut">    <div class="tooltipsText">        <div class="tooltipsLinkMessage">            <span class="boldedText" id="tipTitle">                <TextBlock Text="{TemplateBinding Title}" />            <\/span>            <TextBlock Text="{TemplateBinding PreLink}" />            <a role="button" aria-label="{Binding resources.NewCollectionConfirmationLabel}" href="#" event:click="onLinkClicked" class="tooltipsLink" target="_blank">                <TextBlock Text="{TemplateBinding Link}" />            <\/a>            <TextBlock Text="{TemplateBinding PostLink}" />        <\/div>    <\/div><\/div>',ki='<div class="{Binding ShowSaveButton Converter=saveRootClass}" data-tag="saveRoot">    <div class="auxillaryButtons" style:display="{Binding ShowSaveButton Converter=boolToDisplay}">        <a class="saveButton" data-tag="saveButton" event:click="onSaveClick" href="#">            <span class="saveButtonIcon"><\/span>        <\/a>    <\/div>    <div class="saveDropdown popOutTop" style:display="{Binding ShowDropdown Converter=boolToDisplay}" style:top="{Binding TopPosition}" style:left="{Binding LeftPosition}">        <div class="popOutInner" data-tag="popOutInner">            <a class="saveEntry bm_dropdownEntry" data-tag="saveEntry" event:click="onFavoritesClick" href="#" style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}">                <span class="saveButton saveIcon"><\/span>                <TextBlock Text="{Binding resources.L_FavoriteTitle_Text}" />            <\/a>            <div class="transientLensSeparator" style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}"><\/div>            <ItemsControl ItemsSource="{Binding Itineraries}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <a class="saveEntry bm_dropdownEntry" data-tag="saveEntry" data-entityid="{Binding collectionId}" event:click="onItineraryClick" href="#">                            <span class="saveButton saveIcon"><\/span>                            <TextBlock Text="{Binding Name}" />                        <\/a>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>            <div class="transientLensSeparator" style:display="{Binding signInState.IsSignedIn Converter=boolToDisplay}"><\/div>            <a class="saveEntry bm_dropdownEntry" data-tag="saveEntry" event:click="onTemporaryCollectionClick" href="#">                <span class="saveButton saveIcon"><\/span>                <TextBlock Text="{Binding resources.L_TemporaryCollectionTitle}" />            <\/a>            <ItemsControl ItemsSource="{Binding Collections}">                <ItemsControl.ItemTemplate>                    <DataTemplate>                        <a class="saveEntry bm_dropdownEntry" data-tag="saveEntry" data-entityid="{Binding id}" event:click="onCollectionClick" href="#" style="{Binding collectionId Converter=collectionIdToDisplayNone}">                            <span class="saveButton saveIcon"><\/span>                            <TextBlock Text="{Binding name}" />                        <\/a>                    <\/DataTemplate>                <\/ItemsControl.ItemTemplate>            <\/ItemsControl>        <\/div>    <\/div><\/div>',b=this&&this.__extends||function(){var n=function(t,i){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(n,t){n.__proto__=t}||function(n,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])},n(t,i)};return function(t,i){function r(){this.constructor=t}if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");n(t,i);t.prototype=i===null?Object.create(i):(r.prototype=i.prototype,new r)}}(),st=function(t){function i(n){var i=t.call(this,n)||this;return i.geometryType=1,i.crs=wt.instance,i}return b(i,t),i.prototype.dispose=function(){this.entity.dispose();this.entity=null;this.geometry=null;this.crs=null;n.useJsonApiForFavorites&&(this.updated=new k)},i.prototype.getGeometry=function(){return this.geometry},i.prototype.setGeometry=function(n){this.geometry=n;this.entity&&this.entity.setGeometry(n)},i.prototype.getArea=function(){return 0},i.prototype.getLength=function(){return 0},i.prototype.createPointFromSimplePoint=function(t){var i=this;return t.entity&&(t.entity.name&&t.entity.name.length>0||t.entity.originalName&&t.entity.originalName.length>0)?(this.entity=new kt,this.entity.createFavoriteFromCollectionEntity(t.entity),this.geometry=t.geometry,this.geometryType=1,this.entity.geometry=t.geometry,this.entity.geometryType=1,n.useJsonApiForFavorites&&this.entity.updated.add(function(n){i.updated.invoke(n)}),this.geometry!==null):!1},i.prototype.createPointFromPlace=function(n){return this.entity=new kt,this.entity.createFavoriteFromPlace(n),this.geometry=this.entity.getGeometry(),this.geometry!==null},i.prototype.getSimplePoint=function(){var n=new y;return n.geometry=this.geometry,n.geometryType=this.geometryType,n.entity=this.entity.ToCollectionEntity(),n},i.prototype.isTapEnabled=function(){return!0},i}(it),u=function(r){function u(n,i,u){var f=r.call(this)||this;return f.primitives=new c,f._privates.defineProperty("itemCount"),f.id=n,f.name=i,f.disposed=new k,f.eTag="0",f.dateCreated=t.convertJavascriptDateToDateInTicks(new Date),f.dateModified=f.dateCreated,f.dateAccessed=f.dateCreated,f.primitives.changed.add(function(){f.setItemCount(f.primitives.length)}),f.collageImages=new c,f.isAutoCollection=u,f}return b(u,r),u.deserialize=function(n,t){var i,o,e,r,f;if(t)return u.deserializeCgCollection(n);if(n&&n.id&&n.name&&(i=new u(n.id,n.name),i.description=n.description,i.isPublic=n.isPublic,n.primitives))for(o=n.primitives.length,e=0;e<o;e++){r=n.primitives[e];switch(r.geometryType){case 1:f=y.deserialize(r);break;case 2:f=at.deserialize(r);i.containsPolyshapes=!0;break;case 3:f=lt.deserialize(r);i.containsPolyshapes=!0}f&&i.primitives.insert(f)}return i},u.deserializeCgCollection=function(n){var i,o,s,h,l,r,f,e;if(n&&n.CollectionId&&(n.Name||t.isDefaultCollectionId(n.CollectionId))){if(i=new u(n.CollectionId,u._getCollectionName(n)),i.description=n.Description,i.isPublic=n.CanShare,i.eTag=n.ETag,i.dateAccessed=n.DateAccessed,i.dateCreated=n.DateCreated,i.dateModified=n.DateModified,i.setItemCount(n.ItemsCount),o=n.Properties&&n.Properties.ImageUrls,o&&o.length){for(s=w.Internals.parseJSON(o),h=new c,r=0;r<s.length;r++)h.insert(s[r]);i.collageImages=h}if(n.Items)for(l=n.Items.length,i.setItemCount(l),r=0;r<l;r++){if(f=n.Items[r],f.Geometry)switch(f.Geometry.$type){case"GeometryPoint":e=y.deserialize(f,!0);break;case"GeometryLine":e=at.deserialize(f,!0);i.containsPolyshapes=!0;break;case"GeometryPolygon":e=lt.deserialize(f,!0);i.containsPolyshapes=!0}else e=y.deserialize(f,!0);e&&(e.AdditionalType=f.AdditionalType,i.primitives.insert(e))}}return i},u.serialize=function(n,t){var r,s,o,f,e;if(t)return u.serializeCgCollection(n);if(n&&(r={},r[i.id]=n.id,r[i.nameField]=n.name,r[i.description]=n.description,r[i.isPublic]=n.isPublic,r[i.primitives]=[],n.primitives))for(s=n.primitives.length,o=0;o<s;o++){f=n.primitives[o];switch(f[i.geometryType]){case 1:e=y.serialize(f);break;case 2:e=at.serialize(f);break;case 3:e=lt.serialize(f)}e&&r[i.primitives].push(e)}return r},u.serializeCgCollection=function(n){var r,o,s,e,u,f;if(n){if(o=t.convertJavascriptDateToDateInTicks(new Date),r={$type:"GeoAnnotationsCollection",Name:n.name,Description:n.description,CanShare:n.isPublic,Items:[],AlwaysShowPOI:!0,CopyAllowed:!0,DisplayOrder:1,DateCreated:n.dateCreated,DateModified:o,DateAccessed:o},r.Properties={ImageUrls:w.Internals.stringify(n.collageImages.slice())},n.id&&(r.CollectionId=n.id),n.primitives)for(s=n.primitives.length,e=0;e<s;e++){u=n.primitives[e];switch(u[i.geometryType]){case 1:f=y.serialize(u,!0);break;case 2:f=at.serialize(u,!0);break;case 3:f=lt.serialize(u,!0)}f&&(f.AdditionalType=u.AdditionalType,r.Items.push(f))}r.ItemsCount=r.Items.length}return r},u.prototype.copy=function(){var n=new u(this.id,this.name);return n.description=this.description,n.isPublic=this.isPublic,n.primitives=new c,n},u._getCollectionName=function(t){return n.useJsonApiForFavorites?t.Name?t.Name:t.CollectionId===u.favoritesCollectionId?a.L_FavoriteTitle_Text:t.CollectionId===u.keyPlacesCollectionId?a.L_KeyPlacesTitle_Text:a.L_UpcomingEventsName:t.Name||a.L_UpcomingEventsName},u.localCollectionId="0",u.upcomingEventsId="default.user.upcomingevents",u.favoritesCollectionId="default.user.favorites",u.keyPlacesCollectionId="default.user.keyplaces",u}(it),bt=function(){function n(){this.collections=new c;this.autocollections=new c}return n.prototype.sortCollections=function(){var n,t,r,u,i;if(this.collections.length!==0)for(n=this.collections,t=1;t<n.length;t++)if(r=n[t],u=r.dateModified,!(u<n[t-1].dateModified)){for(n.removeAt(t),i=t-2,i;i>=0;i--)if(u<n[i].dateModified)break;n.insert(r,i+1)}},n.deserialize=function(t,i){var f,o,r,e;if(t)for(f=new n,o=t.length,r=0;r<o;r++)e=u.deserialize(t[r],i),e&&f.collections.insert(e);return f},n.serialize=function(n,t){var r=[],f,i;if(n&&n.collections)for(f=n.collections.length,i=0;i<f;i++)r[i]=u.serialize(n.collections[i],t);return r},n.getAllCollectionNamesAndIds=function(n){var i=[],r,t,u;if(n&&n.collections)for(r=n.collections.length,t=0;t<r;t++)u={name:n.collections[t].name,id:n.collections[t].id},i[t]=u;return i},n}(),t=function(){function n(){}return n.logAction=function(n,t){var r={logData:{feature:i.logFeatureName,action:n,data:t},impressionGuid:et.dynamicProperties.mapsIG};ti.invokeHandler(ni.instrumentationDataHandlerKey,r)},n.perfLog=function(n,t){return n?n.start("CX_"+t):null},n._getLocations=function(n){var r,t,i;return n&&(t=n,t.rings&&t.rings.length>0?r={x:t.rings[0].x,y:t.rings[0].y}:(i=n,i.x&&i.y&&(r={x:i.x,y:i.y}))),r},n.calculateLength=function(t){var u=0,i,f,r;if(t&&(i=n._getLocations(t),i&&i.x.length>=2))for(f=i.x.length,r=0;r<f-1;r++)u+=n._greatCircleDistance(i.y[r],i.x[r],i.y[r+1],i.x[r+1]);return u},n.calculateArea=function(t){var l=0,i,r;if(t&&(i=n._getLocations(t),i&&i.x.length>=3)){var u=n.getMedianCentroid(t),o=n._getUnitSpherePoint(u[0],u[1]),a=n._getTangentPlaneBasis(o),v=a[0],y=a[1],s=0,p=0,h=n._greatCircleDistance(u[0],u[1],i.y[p],i.x[p])/ft.earthRadiusMajorAxis,c,f=n._getProjectedCoordinates(o,v,y,i.y[0],i.x[0]),e;if(f.length===0)return-1;var b=h,k=f,w=i.x.length;for(r=1;r<w;r++){if(c=n._greatCircleDistance(u[0],u[1],i.y[r],i.x[r])/ft.earthRadiusMajorAxis,e=n._getProjectedCoordinates(o,v,y,i.y[r],i.x[r]),e.length===0)return-1;s=s+n._signedExcess(n._triangleExcess(i.y[r-1],i.x[r-1],i.y[r],i.x[r],h,c),f,e);f=e;h=c}l=Math.abs(s)*ft.earthRadiusMajorAxis*ft.earthRadiusMajorAxis}return l},n.getMedianCentroid=function(t){var i=[0,0],r=n._getLocations(t);return r&&r.x.length>=3&&(i[0]=(t.bounds[0]+t.bounds[2])/2,i[1]=(t.bounds[1]+t.bounds[3])/2),i},n.hasSearchId=function(t){var i=(t||"").toLowerCase(),r=i.match(n.ypidRegex);return r&&r.length>0||i.indexOf("sid")!==-1||i.indexOf("eventId")!==-1},n.hasSatoriId=function(t){var i=(t||"").toLowerCase(),r=i.match(n.sidRegex);return r&&r.length>0||i.indexOf("sid")!==-1},n.hasEventId=function(t){var i=(t||"").toLowerCase(),r=i.match(n.eventIdRegex)||i.match(n.sidRegex);return r&&r.length>0||i.indexOf("eventId")!==-1},n.addIdPrefix=function(t){return n.hasSatoriId(t)?t.indexOf("sid:")===-1&&(t="sid:"+t):n.hasEventId(t)?t.indexOf("eventId:")===-1&&(t="eventId:"+t):n.hasSearchId(t)&&t.indexOf("ypid:")===-1&&(t="ypid:"+t),t},n.convertDashesToStrokeDashStyle=function(n){for(var i="",t=0;t<n.length;t++)i+=n[t],t<n.length-1&&(i+=",");return i},n.convertStrokeDashStyleToDashes=function(t){var i,r,u,f;if(!t)return n.solidDashStyle;switch(t.toUpperCase()){case"SOLID":i=n.solidDashStyle;break;case"SHORTDASH":i=n.shortDashStyle;break;case"SHORTDOT":i=n.shortDotStyle;break;case"SHORTDASHDOT":i=n.shortDashDotStyle;break;case"SHORTDASHDOTDOT":i=n.shortDashDotDotStyle;break;case"DOT":i=n.dotStyle;break;case"DASH":i=n.dashStyle;break;case"LONGDASH":i=n.longDashStyle;break;case"DASHDOT":i=n.dashDotStyle;break;case"LONGDASHDOT":i=n.longDashDotStyle;break;case"LONGDASHDOTDOT":i=n.longDashDotDotStyle;break;default:if(r=t.split(","),r.length===1||r.length===0||r.length%2!=0)i=n.solidDashStyle;else{for(i=[],u=0;u<r.length;u++)f=parseInt(r[u]),isNaN(f)||i.push(f);i.length===0&&(i=n.solidDashStyle)}}return i},n.convertLineWidthToStrokeWeight=function(n){return n+"px"},n.convertStrokeWeightToLineWidth=function(n){if(!n)return 1;var i,t;return n.indexOf("px")!==-1?(t=parseInt(n.substr(0,n.length-2)),i=t):n.indexOf("em")!==-1?(t=parseFloat(n.substr(0,n.length-2)),i=8*t):n.indexOf("en")!==-1?(t=parseFloat(n.substr(0,n.length-2)),i=6*t):n.indexOf("pt")!==-1?(t=parseFloat(n.substr(0,n.length-2)),i=2*t):n.indexOf("%")!==-1?(t=parseFloat(n.substr(0,n.length-1)),i=1):(t=parseInt(n),i=t),i},n.convertDateInTicksToJavascriptDate=function(t){var i=(new Date).getTimezoneOffset()*6e4;return new Date(t/1e4-n.epochDiff+i)},n.convertJavascriptDateToDateInTicks=function(t){var i=(new Date).getTimezoneOffset()*6e4;return(t.getTime()+n.epochDiff-i)*1e4},n.isDefaultCollectionId=function(n){if(!n)return!1;switch(n){case u.upcomingEventsId:case u.favoritesCollectionId:case u.keyPlacesCollectionId:return!0;default:return!1}},n.isKeyPlacesCollectionId=function(n){if(n){if(n===u.keyPlacesCollectionId)return!0}else return!1;return!1},n.computeStartTime=function(t,i,r){i===void 0&&(i=0);r===void 0&&(r=0);var u=n.computeStartTimeInHours(t,i,r),e=u[0],f=u[1],o=e.toString();return o+(f>0&&f<=30?":30:00":":00:00")},n.createStartTimeInAPM=function(t,i,r){var s;if(i===void 0&&(i=0),r===void 0&&(r=0),t){var f=n.computeStartTimeInHours(t,i,r),u=f[0],e=f[1],o=(u%12||12).toString();return o+=e>0&&e<=30?":30":":00",s=u<12||u===24?" AM":" PM",o+s}return""},n.computeStartTimeInHours=function(t,i,r){var f,u,e;return i===void 0&&(i=0),r===void 0&&(r=0),f=i+r/60,f+=n.computeTimeInMinutes(t),u=Math.floor(f/60),e=f%60,e>30&&u++,u=u%24,[u,e]},n.computeTimeInMinutes=function(n){if(n){var t=n.split(":");if(t.length>1)return parseInt(t[0])*60+parseInt(t[1])}return 0},n._greatCircleDistance=function(n,t,i,r){return ft.greatCircleDistance(new l(n,t),new l(i,r))},n._getUnitSpherePoint=function(n,t){var i=[0,0,0],r=Math.PI/180;return i[0]=Math.cos(n*r),i[1]=i[0]*Math.sin(t*r),i[0]=i[0]*Math.cos(t*r),i[2]=Math.sin(n*r),i},n._getTangentPlaneBasis=function(n){var t=[0,0,0],u=[0,0,0],e=[t,u],r=0,i=1,f;return Math.abs(n[2])>Math.abs(n[0])?(r=2,Math.abs(n[0])>Math.abs(n[1])&&(i=0)):Math.abs(n[2])>Math.abs(n[1])&&(i=2),f=Math.sqrt(n[r]*n[r]+n[i]*n[i]),t[r]=-n[i]/f,t[i]=n[r]/f,u[0]=n[1]*t[2]-n[2]*t[1],u[1]=n[2]*t[0]-n[0]*t[2],u[2]=n[0]*t[1]-n[1]*t[0],e},n._getProjectedCoordinates=function(t,i,r,u,f){var o=[],e=n._getUnitSpherePoint(u,f),s=e[0]*t[0]+e[1]*t[1]+e[2]*t[2];return s>0&&(e[0]=e[0]-t[0],e[1]=e[1]-t[1],e[2]=e[2]-t[2],o[0]=(e[0]*i[0]+e[1]*i[1]+e[2]*i[2])/s,o[1]=(e[0]*r[0]+e[1]*r[1]+e[2]*r[2])/s),o},n._triangleExcess=function(t,i,r,u,f,e){var s=n._greatCircleDistance(t,i,r,u)/ft.earthRadiusMajorAxis,o=(f+e+s)/2;return o=Math.tan(o/2)*Math.tan((o-f)/2)*Math.tan((o-e)/2)*Math.tan((o-s)/2),o>0?(o=Math.sqrt(o),o=4*Math.atan(o)):o=0,o},n._signedExcess=function(n,t,i){return t[0]*i[1]-i[0]*t[1]>0?n:-n},n.ypidRegex="yn\\d+x[A-Z,a-z,0-9]+",n.eventIdRegex="f\\d{9}",n.sidRegex="^[A-Z,a-z,0-9]{8}-[A-Z,a-z,0-9]{4}-[A-Z,a-z,0-9]{4}-[A-Z,a-z,0-9]{4}-[A-Z,a-z,0-9]{12}",n.solidDashStyle=[0],n.shortDashStyle=[6,2],n.shortDotStyle=[2,2],n.shortDashDotStyle=[6,2,2,2],n.shortDashDotDotStyle=[6,2,2,2,2,2],n.dotStyle=[2,6],n.dashStyle=[10,6],n.longDashStyle=[20,6],n.dashDotStyle=[10,6,2,6],n.longDashDotStyle=[20,6,2,6],n.longDashDotDotStyle=[20,6,2,6,2,6],n.epochDiff=621355968e5,n}(),o=function(){function i(){}return i.makeCgRetrieveAllCollectionsMetadataRequest=function(t,r){var f={RequestType:1,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},u=null;e.getFunctionalTestHooksEnabled()&&(u=n.retrieveAllCollectionsBag);i._makeCgRequest(t,r,f,u)},i.makeCgRetrieveAllCollectionsRequest=function(t,r){var u={RequestType:2,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion};i._makeCgRequest(t,r,u)},i.makeCgRetrieveCollectionRequest=function(t,r,u,f){var s={RequestType:3,CollectionId:t,ClientETag:r,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},o=null;e.getFunctionalTestHooksEnabled()&&(o=n.retrieveCollectionBag);i._makeCgRequest(u,f,s,o)},i.makeCgRetrieveUpcomingEventsRequest=function(r,f){var h=t.convertJavascriptDateToDateInTicks(new Date),s={RequestType:3,CollectionId:u.upcomingEventsId,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},o;s.EventTimeRangeFilterUTC={StartTime:h};o=null;e.getFunctionalTestHooksEnabled()&&(o=n.retrieveCollectionBag);i._makeCgRequest(r,f,s,o,n.testUser)},i.makeCgRetrieveSharedCollectionRequest=function(t,r,u,f,o){var h={RequestType:10,CollectionId:t,ClientETag:r,ExternalUserId:u,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion},s=null;e.getFunctionalTestHooksEnabled()&&(s=n.retrieveCollectionBag);i._makeCgRequest(f,o,h,s)},i.makeCgCreateCollectionRequest=function(t,r,f){var s={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.eTag,CollectionToBeWritten:u.serialize(t,!0)},o=null;e.getFunctionalTestHooksEnabled()&&(o=n.insertCollectionBag);i._makeCgRequest(r,f,s,o)},i.makeCgUpdateCollectionRequest=function(t,r,f){var s={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.eTag,CollectionId:t.id,CollectionToBeWritten:u.serialize(t,!0)},o=null;e.getFunctionalTestHooksEnabled()&&(o=n.updateCollectionBag);i._makeCgRequest(r,f,s,o)},i.makeCgUpdateCollectionMetadataRequest=function(t,r,f){var s=u.serialize(t,!0),h,o;s.Items=null;h={RequestType:6,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.eTag,CollectionId:t.id,MetaToBeWritten:s};o=null;e.getFunctionalTestHooksEnabled()&&(o=n.updateCollectionMetaBag);i._makeCgRequest(r,f,h,o)},i.makeCgAddPrimitiveRequest=function(r,u,f,o,s){var c,h,l;if(u){switch(u.geometryType){case 1:c=y.serialize(u,!0);break;case 2:c=at.serialize(u,!0);break;case 3:c=lt.serialize(u,!0);break;default:o&&o(1);return}h={RequestType:4,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:r.eTag,CollectionId:r.id,ItemToBeWritten:c};n.useJsonApiForFavorites&&t.isDefaultCollectionId(r.id)&&(h.CollectionType=3,h.EntityId=c.EntityId,h.ItemToBeWritten.Geometry=null,h.ItemToBeWritten.DisplayCoordinates.$type=undefined,h.ItemToBeWritten.RoutableCoordinates=null);l=null;e.getFunctionalTestHooksEnabled()&&(l=n.insertItemBag);s&&(h.ItemId=u.entity.id);i._makeCgRequest(f,o,h,l)}},i.makeCgDeleteCollectionRequest=function(t,r,u){var o={RequestType:7,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.eTag,CollectionId:t.id},f=null;e.getFunctionalTestHooksEnabled()&&(f=n.deleteCollectionBag);i._makeCgRequest(r,u,o,f)},i.makeCgDeletePrimitiveRequest=function(r,u,f,o){var s={RequestType:8,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:u.eTag,CollectionId:u.id,ItemId:r},h;n.useJsonApiForFavorites&&t.isDefaultCollectionId(u.id)&&(s.CollectionType=3,s.EntityId=r);h=null;e.getFunctionalTestHooksEnabled()&&(h=n.deleteItemBag);i._makeCgRequest(f,o,s,h)},i._getMarket=function(){return et.dynamicProperties.market},i._makeCgRequest=function(i,r,u,f,e){function h(n){i&&i(w.Internals.parseJSON(n))}function c(n,i,f){r&&(n&&n!==" "&&!!i?(i===404&&f.indexOf("No Collection found for the user")!==-1||t.logAction(v.pdpRequestFailure,{status:i,statusText:f,reqType:u.RequestType,colId:u.CollectionId}),r(1,w.Internals.parseJSON(n),i)):i===304?r(0,null):(t.logAction(v.pdpRequestFailure,{status:i,statusText:f,reqType:u.RequestType,colId:u.CollectionId}),r(1,null)))}var o=n.cgApiUrl,s;f&&(o=f);e&&(s={"Test-User-AuthToken":e});ci.doPost(o,w.Internals.stringify(u),{onError:c,onSuccess:h,headers:s})},i}(),ht=function(){function i(t){if(this._invalidIndex=-1,this._collectionAlreadyLogged=!1,this._myPlacesAlreadyLogged=!1,this._favoritesAlreadyLogged=!1,i.instance&&!t)return i.instance;this.favoritesLoaded=new k;this.favoritePrimitivesChanged=new k;this.homeOrWorkChanged=new k;this.favoritesFailedToLoad=new k;this.upcomingEventsSet=new k;this.collectionAdded=new k;this.autoCollectionsGenerated=new k;this._favoritesSynced=!1;typeof graph!="undefined"&&(graph.Settings._useSSL=window.location.protocol==="https:",graph.Settings._useProd=n.clientGraphUseProd)}return i.prototype.doesMyPlacesExist=function(){return!!this._myPlaces},i.prototype.findCollectionById=function(n){var r=null,u,t,i;if(n&&this._myPlaces)for(u=this._myPlaces.collections.length,t=0;t<u;t++)if(i=this._myPlaces.collections[t],i.id.toLowerCase()===n.toLowerCase()){r=i;break}return r},i.ensureGraphCommit=function(t){if(n.useJsonApiForFavorites)t&&t(200);else{var i,r=0;i=function(n){r++;n!==200?r<=4?graph.Sync(i):t&&t(n):t&&t(n)};e.getFunctionalTestHooksEnabled()||graph.Sync(i)}},i.prototype.syncFavorites=function(r){var f=this,o,s;(typeof graph!="undefined"||n.useJsonApiForFavorites)&&(o=function(u){var h,e,a,l;if(u===200){if(!n.useJsonApiForFavorites){var y=graph.Me.Preferences.Favorites.GetPreferredPlace(graph.Entities.FavoritesCategoryHome),p=graph.Me.Preferences.Favorites.GetPreferredPlace(graph.Entities.FavoritesCategoryWork),w=graph.Me.Preferences.Favorites.Collections.Default.Members,o,s;for(f.favorites=new c,h=w.Count-1;h>=0;h--)if(e=w.GetAt(h),e.IsEntity&&e.Type===graph.Entities.Place){if(y===e&&!o){o=new st;o.createPointFromPlace(y)&&(f.home=o,f.home.entity.setIsHomeOrWork("home"));continue}if(p===e&&!s){s=new st;s.createPointFromPlace(p)&&(f.work=s,f.work.entity.setIsHomeOrWork("work"));continue}a=new st;l=e;(l.Geometry||l.DisplayCoordinates)&&a.createPointFromPlace(l)&&f.favorites.insert(a)}}f.favoriteErrorCode=0;f.favoritesLoaded.invoke();f._favoritesAlreadyLogged||(t.logAction(v.itemCounts,{FAV:f.favorites.length}),f._favoritesAlreadyLogged=!0);f.favoritePrimitivesChanged.invoke();f._favoritesSynced=!0;r(0);i.ensureGraphCommit()}else f.favoriteErrorCode=9,f.favoritesFailedToLoad.invoke(),r(9)},e.getFunctionalTestHooksEnabled()?(!n.returnMockFavorites||this.favorites&&this.favorites.length||(n.useJsonApiForFavorites?this._mockFavoritesForJsonEndpoint():this._fillGraphWithMockFavorites()),o(200)):this._favoritesSynced?(r(0),n.useJsonApiForFavorites||i.ensureGraphCommit()):n.useJsonApiForFavorites?(s=function(n,t){n&&t===0?(f._convertFavoritesCollectionsFromJsonEndpoint(n),o(200)):o(t)},this.retrieveCollection(u.favoritesCollectionId,s)):i.ensureGraphCommit(o))},i.prototype.setHome=function(r,u){var f=this,o,s;(typeof graph!="undefined"||n.useJsonApiForFavorites)&&(o=function(t,i){if(i===0||i===10&&t!==f.work){if(!n.useJsonApiForFavorites){var r=t.entity.getPlace();graph.Me.Preferences.Favorites.SetPreferredPlace(graph.Entities.FavoritesCategoryHome,r);f.favorites.indexOf(t)!==-1&&f.favorites.remove(t)}f.home&&f.favorites.indexOf(f.home)===-1&&f.home.entity.removePlace();f.home=t;f.home.entity.setIsHomeOrWork("home");f.homeOrWorkChanged.invoke();f.favoritePrimitivesChanged.invoke();u(t,0)}else u(null,i)},r.entity.getPlace()!==null||n.useJsonApiForFavorites?(s=function(n){n===200?(o(r,0),t.logAction(v.favorites,{SHM:"True"}),i.ensureGraphCommit()):(t.logAction(v.favorites,{SHM:"False",ERR:n}),o(r,9))},e.getFunctionalTestHooksEnabled()?s(200):n.useJsonApiForFavorites?(r.AdditionalType="category/Home",r.entity.id=r.entity.getBusinesslistingid(),this.home?this._updateHomeOrWork(r,this.home,o):this.createFavorite(r,o)):i.ensureGraphCommit(s)):this.createFavorite(r,o))},i.prototype.setWork=function(r,u){var f=this,o,s;(typeof graph!="undefined"||n.useJsonApiForFavorites)&&(o=function(t,i){if(i===0||i===10&&t!==f.home){if(!n.useJsonApiForFavorites){var r=t.entity.getPlace();graph.Me.Preferences.Favorites.SetPreferredPlace(graph.Entities.FavoritesCategoryWork,r);f.favorites.indexOf(t)!==-1&&f.favorites.remove(t)}f.work&&f.favorites.indexOf(f.work)===-1&&f.work.entity.removePlace();f.work=t;f.work.entity.setIsHomeOrWork("work");f.homeOrWorkChanged.invoke();f.favoritePrimitivesChanged.invoke();u(t,0)}else u(null,i)},r.entity.getPlace()!==null||n.useJsonApiForFavorites?(s=function(n){n===200?(o(r,0),t.logAction(v.favorites,{SWK:"True"}),i.ensureGraphCommit()):(t.logAction(v.favorites,{SWK:"False",ERR:n}),o(r,9))},e.getFunctionalTestHooksEnabled()?s(200):n.useJsonApiForFavorites?(r.AdditionalType="category/Work",r.entity.id=r.entity.getBusinesslistingid(),this.work?this._updateHomeOrWork(r,this.work,o):this.createFavorite(r,o)):i.ensureGraphCommit(s)):this.createFavorite(r,o))},i.prototype.createFavorite=function(r,f,o){var s=this,h;(typeof graph!="undefined"||n.useJsonApiForFavorites)&&r&&r.entity&&(h=function(h){var c,a,l,p,y;h===200?(c=r.entity.getPlaceId(),n.useJsonApiForFavorites&&(r.entity.id=c),a=s.getExistingFavorite(c),a!==null?f(a,12):(l=s.favorites.length,!n.useJsonApiForFavorites&&s.home&&l++,!n.useJsonApiForFavorites&&s.work&&l++,l>=i._maxFavorites?f(null,4):(c=t.addIdPrefix(c),r.entity.setBusinesslistingid(c),s.favorites.indexOf(r)===-1&&(n.useJsonApiForFavorites?(p=function(n,t){t!==0||r.AdditionalType||(s.favorites.insert(r,0),s.favoritePrimitivesChanged.invoke());f(r,0)},y=r.AdditionalType?u.keyPlacesCollectionId:u.favoritesCollectionId,e.getFunctionalTestHooksEnabled()?(r.entity.updateCollectionEntityProperties(),r.entity.createPlaceFromFavorite(),s.favorites.insert(r,0),s.favoritePrimitivesChanged.invoke(),f(r,0)):s.retrieveCollection(y,function(n,t){t===0&&n&&(r.entity.updateCollectionEntityProperties(),r.entity.createPlaceFromFavorite(),s._registerForUpdateEvent(r,n),r.entity.updated.add(function(n){r.updated.invoke(n)}),s.addPrimitive(y,r,p))})):(s.favorites.insert(r,0),s.favoritePrimitivesChanged.invoke())),n.useJsonApiForFavorites||r.entity.createPlaceFromFavorite(),n.useJsonApiForFavorites||f(r,0),t.logAction(v.favorites,{CFA:"True",SL:o?o:1}),i.ensureGraphCommit()))):(t.logAction(v.favorites,{CFA:"False",ERR:h}),f(null,9))},e.getFunctionalTestHooksEnabled()?h(200):i.ensureGraphCommit(h))},i.prototype.removeFavorite=function(r,f){var o=this,s;(typeof graph!="undefined"||n.useJsonApiForFavorites)&&(s=function(e){if(e===200){var s=!1;o.home===r?(o.home=null,n.useJsonApiForFavorites?(s=!0,o._removeHomeOrWork(r,function(n){n===0&&o.homeOrWorkChanged.invoke()})):(graph.Me.Preferences.Favorites.GetPreferredPlace(graph.Entities.FavoritesCategoryHome).Delete(),o.homeOrWorkChanged.invoke())):o.work===r&&(o.work=null,n.useJsonApiForFavorites?(s=!0,o._removeHomeOrWork(r,function(n){n===0&&o.homeOrWorkChanged.invoke()})):(graph.Me.Preferences.Favorites.GetPreferredPlace(graph.Entities.FavoritesCategoryWork).Delete(),o.homeOrWorkChanged.invoke()));r.entity.removePlace();n.useJsonApiForFavorites?s||o.retrieveCollection(u.favoritesCollectionId,function(n,i){i===0&&n?o.deletePrimitive(u.favoritesCollectionId,r.entity.id,function(n){n===0&&(o.favorites.remove(r),o.favoritePrimitivesChanged.invoke(),f(0),t.logAction(v.favorites,{DEL:"True"}))}):f(i)}):(o.favorites.remove(r),o.favoritePrimitivesChanged.invoke(),f(0),t.logAction(v.favorites,{DEL:"True"}),i.ensureGraphCommit())}else t.logAction(v.favorites,{DEL:"False",ERR:e}),f(9)},e.getFunctionalTestHooksEnabled()?s(200):i.ensureGraphCommit(s))},i.prototype.isExistingFavorite=function(n){return this.getExistingFavorite(n)?!0:!1},i.prototype.getExistingFavorite=function(n){if(this.home&&this.home.entity.id.indexOf(n)!==-1)return this.home;if(this.work&&this.work.entity.id.indexOf(n)!==-1)return this.work;if(this.favorites)for(var t=0;t<this.favorites.length;t++)if(this.favorites[t]&&this.favorites[t].entity.id.indexOf(n)!==-1)return this.favorites[t];return null},i.prototype.retrieveAllCollectionsMetaData=function(t){var r=this;this._myPlaces&&!n.useJsonApiForFavorites?(this._myPlaces.sortCollections(),t&&t(this._myPlaces,0)):this._myPlaces&&n.useJsonApiForFavorites&&i._customCollectionsSynced?(this._myPlaces.sortCollections(),t&&t(this._myPlaces,0)):(i._customCollectionsSynced=!0,o.makeCgRetrieveAllCollectionsMetadataRequest(function(i){return r._handleCollectionsServiceRetrieveAllResponse(i,t,200,n.useJsonApiForFavorites)},function(i,u,f){u===null||u.CollectionsMetaMap?t&&t(null,i?9:0):r._handleCollectionsServiceRetrieveAllResponse(u,t,f,n.useJsonApiForFavorites)}));this.home&&this.work&&this.favorites?this.favoritesLoaded.invoke():this.syncFavorites(function(){})},i.prototype.retrieveAllCollections=function(n){var t=this;o.makeCgRetrieveAllCollectionsRequest(function(i){return t._handleCollectionsServiceRetrieveAllResponse(i,n)},function(i,r,u){r===null||r.CollectionsMap?n&&n(null,i?9:0):t._handleCollectionsServiceRetrieveAllResponse(r,n,u)})},i.prototype.retrieveCollection=function(n,t,i){var f=this,r,u,e,s;!n&&t?t(null,7):(r=this._getCollectionIndexFromCache(n),u=null,r!==this._invalidIndex&&this._myPlaces.collections[r].primitivesRetrieved&&(u=this._myPlaces.collections[r].eTag),e=function(n){return f._handleSingleCollectionResponse(n,t,r,!0)},s=function(n,i){i===null||i.CollectionsMap?n===0?t&&t(f._myPlaces.collections[r],0):t&&t(null,n?9:0):f._handleSingleCollectionResponse(i,t,r,!0)},i?o.makeCgRetrieveSharedCollectionRequest(n,u,i,e,s):o.makeCgRetrieveCollectionRequest(n,u,e,s))},i.prototype.retrieveUpcomingEvents=function(n){var t=this,i=function(i){var r=function(i,r){r===0&&(t._sortEvents(i),t.upcomingEvents=i,t.upcomingEventsSet.invoke());n(i,r)};return t._handleSingleCollectionResponse(i,r,-1,!0)},r=function(i,r){r===null||r.CollectionsMap||t._handleSingleCollectionResponse(r,n,-1,!0)};o.makeCgRetrieveUpcomingEventsRequest(i,r)},i.prototype.createCollection=function(n,t){var r=this,u;!n&&t?t(null,7):(u=this._getCollectionIndexFromCache(n.id),this._myPlaces&&this._myPlaces.collections.length>=i._getMaxAllowedCollections()?t&&t(null,2):u===this._invalidIndex?o.makeCgCreateCollectionRequest(n,function(i){r._myPlaces||(r._myPlaces=new bt,r._addAutoCollectionsToMyPlaces());r._myPlaces.collections&&r._myPlaces.collections.insert(n,0);n.id=i.CollectionId;n.eTag=i.ServerETag;n.primitivesRetrieved=!0;n.externalUserId=i.ExternalUserId;ut.instance.pushCollection(n);t(n,0)},function(n){t&&t(null,n?9:0)}):t&&t(null,8))},i.prototype.deleteCollection=function(n,t){var i,r;!n&&t?t(7):(i=this._getCollectionIndexFromCache(n),i!==this._invalidIndex?(r=this._myPlaces.collections[i],this._myPlaces.collections.removeAt(i),o.makeCgDeleteCollectionRequest(r,function(){ut.instance.removeCollection(r);r.disposed.invoke();t(0)},function(n){t&&t(n?9:0)})):t&&t(5))},i.prototype.updateCollection=function(n,t){var r=this,i;!n&&t?t(null,7):(i=this._getCollectionIndexFromCache(n.id),n.primitivesRetrieved?o.makeCgUpdateCollectionRequest(n,function(n){return r._handleUpdateCollectionResponse(n,t,i)},function(n){t&&t(null,n?9:0)}):n.primitives.length?this.retrieveCollection(n.id,function(u,f){if(f===0){for(var e=0;e<u.primitives.length;e++)n.primitives.insert(u.primitives[e]);o.makeCgUpdateCollectionRequest(n,function(u){return r._handleUpdateCollectionResponse(u,t,i,n)},function(n){t&&t(null,n?9:0)})}else t&&t(null,f)}):o.makeCgUpdateCollectionMetadataRequest(n,function(n){return r._handleUpdateCollectionResponse(n,t,i)},function(n){t&&t(null,n?9:0)}))},i.prototype.updateCollectionMeta=function(n,t){var r=this,i;!n&&t?t(null,7):(i=this._getCollectionIndexFromCache(n.id),o.makeCgUpdateCollectionMetadataRequest(n,function(n){return r._handleUpdateCollectionResponse(n,t,i)},function(n){t&&t(null,n?9:0)}))},i.prototype.addPrimitive=function(r,u,f){var c=this,h,e,l;f&&(r?u?(h=this._getCollectionIndexFromCache(r),h===this._invalidIndex?f(null,5):!u.entity||u.entity.id===s.localEntityId||n.useJsonApiForFavorites&&t.isDefaultCollectionId(r)?(e=this._myPlaces.collections[h],l=this._checkIfRequestShouldBeDone(e,u),e.primitivesRetrieved&&e.primitives.length>=i._getMaxAllowedCollectionEntites()||e.getItemCount()>=i._getMaxAllowedCollectionEntites()?f(null,3):l?o.makeCgAddPrimitiveRequest(e,u,function(n){n.ItemId&&(u.entity.id=n.ItemId);e.primitives.insert(u,0);n.ServerETag&&(e.eTag=n.ServerETag);c._filterOutPolylinesAndPolygons(e,!1);t.isDefaultCollectionId(r)||c._updateCollectionMetaWithAddedImageCollage(e,u);ut.instance.pushCollection(e);f&&f(e,0,n.ItemId)},function(n){f(null,n===0?0:9)}):f(e,12)):f(null,10)):f(null,10):f(null,7))},i.prototype.deletePrimitive=function(n,i,r){var s=this,f,e,u;r&&(n?i?(f=this._getPrimitiveIndexFromCollection(n,i),f!==this._invalidIndex?(e=this._getCollectionIndexFromCache(n),u=this._myPlaces.collections[e],o.makeCgDeletePrimitiveRequest(i,u,function(i){i.ServerETag&&(u.eTag=i.ServerETag);var e=u.primitives[f].entity.photoUrl;u.primitives.removeAt(f);t.isDefaultCollectionId(n)||s._updateCollectionMetaWithRemovedImageCollage(u,e);u.primitives.changed.invoke();r(0)},function(){r(9)})):r(11)):r(10):r(7))},i.prototype.updatePrimitive=function(n,t,i){if(i)if(n)if(t){var r=this._getPrimitiveIndexFromCollection(n.id,t.entity.id);r===this._invalidIndex?i(11):o.makeCgAddPrimitiveRequest(n,t,function(t){t.ServerETag&&(n.eTag=t.ServerETag);i&&i(0)},function(n){i(n===0?0:9)},!0)}else i(10);else i(7)},i.prototype._updateCollectionMetaWithAddedImageCollage=function(n,t){var i=t.entity.photoUrl;i&&n.collageImages.length<3&&n.collageImages.insert(i,0);this.updateCollectionMeta(n,function(t,i){i===0&&n.changed.invoke()})},i.prototype._updateCollectionMetaWithRemovedImageCollage=function(n,t){var i,r;if(n.collageImages.remove(t),n.collageImages.length<3&&n.primitives.length>=3)for(i=0;i<n.primitives.length;i++)if(r=n.primitives[i].entity.photoUrl,r&&n.collageImages.indexOf(r)===-1){n.collageImages.insert(r);break}this.updateCollectionMeta(n,function(t,i){i===0&&n.changed.invoke()})},i.prototype._handleCollectionsServiceRetrieveAllResponse=function(n,i,r,f){var e=new bt,o=n.RequestType===1?n.CollectionsMetaMap:n.CollectionsMap,h,a,s,c,l;if(o){for(h in o)o.hasOwnProperty(h)&&(a=o[h],s=u.deserialize(a,!0),s&&(s.externalUserId=n.ExternalUserId,e.collections.insert(s)));e.sortCollections();f&&(c=this._getCollectionIndexFromCache(u.favoritesCollectionId),c!==this._invalidIndex&&e.collections.insert(this._myPlaces.collections[c]),l=this._getCollectionIndexFromCache(u.keyPlacesCollectionId),l!==this._invalidIndex&&e.collections.insert(this._myPlaces.collections[l]));this._myPlaces=e;this._addAutoCollectionsToMyPlaces();this._myPlacesAlreadyLogged||(t.logAction(v.itemCounts,{COL:e.collections.length}),this._myPlacesAlreadyLogged=!0);i&&i(this._myPlaces,0)}else n&&r===404?(this._myPlaces=e,i&&i(this._myPlaces,0)):i&&i(this._myPlaces,9)},i.prototype._handleSingleCollectionResponse=function(t,i,r,f,e){var s=t.CollectionsMap,a=this._myPlaces&&this._myPlaces.collections[r],h=a&&s[a.id],c,o,l;if(!h)for(c in s)if(s.hasOwnProperty(c)){h=s[c];break}if(o=u.deserialize(h,!0),!o){i&&i(null,5);return}o.externalUserId=t.ExternalUserId;n.useJsonApiForFavorites&&t.ServerETag&&(o.eTag=t.ServerETag);l=9;o&&(r!==this._invalidIndex?(this._myPlaces.collections[r]=o,this._myPlaces.collections[r].primitivesRetrieved=!e,this._myPlaces.collections.changed.invoke()):n.useJsonApiForFavorites&&r===this._invalidIndex&&o.id===u.keyPlacesCollectionId&&this._myPlaces.collections.insert(o,0),this._filterOutPolylinesAndPolygons(o,f),l=0);i&&i(o,l)},i.prototype._handleUpdateCollectionResponse=function(n,t,i,r){var u=this._myPlaces.collections[i];r&&(u.primitives=r.primitives);n.ServerETag&&(u.eTag=n.ServerETag);t&&t(u,0)},i.prototype.instantiateAutoCollections=function(){var n=this;ui&&ui.container.instanceAsync("AutoCollectionGenerator",function(t){n.autoCollectionGenerator=t;n.autoCollectionGenerator.generateAutoCollections(n.favorites,n.home,n.work);n._autoCollections=[];n.autoCollectionGenerator.labeledCollection.primitives.length&&n._autoCollections.push(n.autoCollectionGenerator.labeledCollection);n.autoCollectionGenerator.nearHomeCollection.primitives.length&&n._autoCollections.push(n.autoCollectionGenerator.nearHomeCollection);n.autoCollectionGenerator.nearWorkCollection.primitives.length&&n._autoCollections.push(n.autoCollectionGenerator.nearWorkCollection);for(var i=0,r=n.autoCollectionGenerator.nearbyCollections.length;i<r;i++)n._autoCollections.push(n.autoCollectionGenerator.nearbyCollections[i].collection);n._myPlaces&&n._addAutoCollectionsToMyPlaces();n.autoCollectionsGenerated.invoke()})},i.prototype._checkIfRequestShouldBeDone=function(n,t){for(var r,u=!0,f=t.entity,i=0;i<n.primitives.length;i++)if(r=n.primitives[i].entity,r.businesslistingid&&f.businesslistingid&&r.businesslistingid===f.businesslistingid){u=!1;break}return u},i.prototype._getCollectionIndexFromCache=function(n){var i=this._invalidIndex,r,t,u;if(n&&this._myPlaces)for(r=this._myPlaces.collections.length,t=0;t<r;t++)if(u=this._myPlaces.collections[t],u.id.toLowerCase()===n.toLowerCase()){i=t;break}return i},i.prototype._getPrimitiveIndexFromCollection=function(n,t){var u=this._getCollectionIndexFromCache(n),f=this._invalidIndex,r,e,i,o;if(u!==this._invalidIndex)for(r=this._myPlaces.collections[u],e=r.primitives.length,i=0;i<e;i++)if(o=r.primitives[i],o.entity.id.toLowerCase()===t.toLowerCase()){f=i;break}return f},i.prototype._filterOutPolylinesAndPolygons=function(i){var r;if(i&&i.primitives){var f=0,u=i.primitives,e=u.length;for(r=u.length-1;r>=0;r--)u[r].geometryType!==1&&(f++,n.enablePolyshapes||u.removeAt(r));n.enablePolyshapes||(i.containsPolyshapes=!1);this._collectionAlreadyLogged||(t.logAction(v.itemCounts,{PRI:e,DRG:f}),this._collectionAlreadyLogged=!0);t.logAction(v.privacySharingState,{PUB:i.isPublic})}},i.prototype._sortEvents=function(n){for(var u,f,r,t=n.primitives,i=1;i<t.length;i++)if(u=t[i],f=u.entity.startDate,!(f.valueOf()>t[i-1].entity.startDate.valueOf())){for(t.removeAt(i),r=i-2,r;r>=0;r--)if(f.valueOf()>t[r].entity.startDate.valueOf())break;t.insert(u,r+1)}},i._getMaxAllowedCollections=function(){return n.maxAllowedCollections},i._getMaxAllowedCollectionEntites=function(){return n.maxAllowedCollectionEntities},i.prototype._fillGraphWithMockFavorites=function(){var n="47.603569_-122.329498",i=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n),t,r,f,e,u;i.Name=graph.CreateText("Seattle");i.OriginalName=graph.CreateText("Seattle");i.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);i.Address.AddressSingleLine=graph.CreateText("Seattle, WA");i.BingEntityId=graph.CreateText("5fbba6b8-85e1-4d41-9444-d9055436e473");i.Description=graph.CreateText("My Home City");i.DisplayCoordinates=graph.CreateGeometryPoint(47.603569,-122.329498);graph.Me.Preferences.Favorites.SetPreferredPlace(graph.Entities.FavoritesCategoryHome,i);n="47.61492538452_-122.1939697265625";t=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);t.Name=graph.CreateText("Microsoft CCP");t.OriginalName=graph.CreateText("Microsoft Bravern");t.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);t.Address.AddressSingleLine=graph.CreateText("500 108th Ave Ne Ste 1810, Bellevue, WA 98004");t.BingEntityId=graph.CreateText(n);t.Description=graph.CreateText("On the 9th floor");t.DisplayCoordinates=graph.CreateGeometryPoint(47.614925384521484,-122.1939697265625);graph.Me.Preferences.Favorites.SetPreferredPlace(graph.Entities.FavoritesCategoryWork,t);n="YN926x15799544";r=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);r.Name=graph.CreateText("Portage Bay Cafe");r.OriginalName=graph.CreateText("Portage Bay Cafe");r.Description=graph.CreateText("My favorite sea food place");r.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);r.Address.AddressSingleLine=graph.CreateText("4130 Roosevelt Way Ne, Seattle, WA, United States");r.BingEntityId=graph.CreateText(n);r.DisplayCoordinates=graph.CreateGeometryPoint(47.657768,-122.317802);n="YN873x112609011";f=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);f.Name=graph.CreateText("Space Needle");f.OriginalName=graph.CreateText("Space Needle");f.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);f.Address.AddressSingleLine=graph.CreateText("400 Broad Street, Seattle, WA, United States");f.BingEntityId=graph.CreateText(n);f.DisplayCoordinates=graph.CreateGeometryPoint(47.620491,-122.349297);n="YN926x15812295";e=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);e.Name=graph.CreateText("Cafe Flora");e.OriginalName=graph.CreateText("Cafe Flora");e.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);e.Address.AddressSingleLine=graph.CreateText("2901 E Madison St, Seattle, WA 98112");e.BingEntityId=graph.CreateText(n);e.DisplayCoordinates=graph.CreateGeometryPoint(47.624046,-122.295097);n="47.640049_-122.129797";u=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(n);u.Name=graph.CreateText("Microsoft Main Campus");u.OriginalName=graph.CreateText("Microsoft Main Campus");u.Description=graph.CreateText("Microsoft Home office");u.Address=graph.CreateTyped(graph.Entities.PostalAddress,n);u.Address.AddressSingleLine=graph.CreateText("1 Microsoft Way, Redmond, WA");u.BingEntityId=graph.CreateText(n);u.DisplayCoordinates=graph.CreateGeometryPoint(47.640049,-122.129797)},i.prototype._mockFavoritesForJsonEndpoint=function(){var o=new u(u.favoritesCollectionId,"Favorites",!1),n=new y,t,i,r,f,e;n.AdditionalType="category/Home";n.geometryType=1;n.geometry={x:-122.329498,y:47.603569,bounds:[]};n.entity=new s("5fbba6b8-85e1-4d41-9444-d9055436e473","Seattle","My Home City");n.entity.AdditionalType="category/Home";n.entity.originalName="Seattle";n.entity.businesslistingid="47.603569_-122.329498";n.entity.id="5fbba6b8-85e1-4d41-9444-d9055436e473";n.entity.labelLocation=new l("47.603569","-122.329498");n.entity.address="Seattle, WA";n.entity.addressFields={addressLine:"Seattle, WA",city:"Seattle",country:"United States",formattedAddress:"Seattle, WA",neighborhood:"Madison Park",postalCode:"98112",stateMunicipality:"WA"};t=new y;t.AdditionalType="category/Work";t.geometryType=1;t.geometry={x:-122.1939697265625,y:47.61492538452,bounds:[]};t.entity=new s(null,"Microsoft CCP","On the 9th floor");t.entity.AdditionalType="category/Work";t.entity.originalName="Microsoft Bravern";t.entity.businesslistingid="47.61492538452_-122.1939697265625";t.entity.labelLocation=new l("47.614925384521484","-122.1939697265625");t.entity.address="500 108th Ave Ne Ste 1810, Bellevue, WA 98004";t.entity.addressFields={addressLine:"500 108th Ave Ne Ste 1810",city:"Bellevue",country:"United States",formattedAddress:"500 108th Ave Ne Ste 1810, Bellevue, WA 98004",neighborhood:"Downtown Bellevue",postalCode:"98004",stateMunicipality:"WA"};i=new y;i.AdditionalType="";i.geometryType=1;i.geometry={x:-122.317802,y:47.657768,bounds:[]};i.entity=new s("YN926x15799544","Portage Bay Cafe","My favorite sea food place");i.entity.AdditionalType="";i.entity.originalName="Portage Bay Cafe";i.entity.businesslistingid="YN926x15799544";i.entity.labelLocation=new l("47.657768","-122.317802");i.entity.address="4130 Roosevelt Way Ne, Seattle, WA, United States";i.entity.addressFields={addressLine:"4130 Roosevelt Way Ne",city:"Seattle",country:"United States",formattedAddress:"4130 Roosevelt Way Ne, Seattle, WA, United States",neighborhood:"University District",postalCode:"98105",stateMunicipality:"WA"};r=new y;r.AdditionalType="";r.geometryType=1;r.geometry={x:-122.349297,y:47.620491,bounds:[]};r.entity=new s("YN873x112609011","Space Needle","");r.entity.AdditionalType="";r.entity.originalName="Space Needle";r.entity.businesslistingid="YN873x112609011";r.entity.labelLocation=new l("47.620491","-122.349297");r.entity.address="400 Broad Street, Seattle, WA, United States";r.entity.addressFields={addressLine:"400 Broad Street",city:"Seattle",country:"United States",formattedAddress:"400 Broad Street, Seattle, WA, United States",neighborhood:"Queen Anne",postalCode:"98109",stateMunicipality:"WA"};f=new y;f.AdditionalType="";f.geometryType=1;f.geometry={x:-122.295097,y:47.624046,bounds:[]};f.entity=new s("YN926x15812295","Cafe Flora","");f.entity.AdditionalType="";f.entity.originalName="Cafe Flora";f.entity.businesslistingid="YN926x15812295";f.entity.labelLocation=new l("47.624046","-122.295097");f.entity.address="2901 E Madison St, Seattle, WA 98112s";f.entity.addressFields={addressLine:"2901 E Madison St",city:"Seattle",country:"United States",formattedAddress:"2901 E Madison St, Seattle, WA 98112",neighborhood:"Stevens",postalCode:"98112",stateMunicipality:"WA"};e=new y;e.AdditionalType="";e.geometryType=1;e.geometry={x:-122.129797,y:47.640049,bounds:[]};e.entity=new s(null,"Microsoft Main Campus","Microsoft Home office");e.entity.AdditionalType="";e.entity.originalName="Microsoft Main Campus";e.entity.businesslistingid="47.640049_-122.129797";e.entity.labelLocation=new l("47.640049","-122.129797");e.entity.address="1 Microsoft Way, Redmond, WA";e.entity.addressFields={addressLine:"1 Microsoft Way",city:"Redmond",country:"United States",formattedAddress:"1 Microsoft Way, Redmond, WA",neighborhood:"University District",postalCode:"98052",stateMunicipality:"WA"};o.primitives=new c;o.primitives.insert(n);o.primitives.insert(t);o.primitives.insert(i);o.primitives.insert(r);o.primitives.insert(f);o.primitives.insert(e);this._convertFavoritesCollectionsFromJsonEndpoint(o)},i.prototype._addAutoCollectionsToMyPlaces=function(){if(this._autoCollections&&this._myPlaces)for(var n=this._autoCollections.length-1;n>=0;n--)this._myPlaces.autocollections.insert(this._autoCollections[n],0)},i.prototype._convertFavoritesCollectionsFromJsonEndpoint=function(n){var r,i,t,f;if(this.favorites=new c,n.primitives&&n.primitives.length>0){for(r=n.primitives.length-1;r>=0;r--)i=new st,t=n.primitives[r],t.geometry&&(t.AdditionalType===null||t.AdditionalType===""?i.createPointFromSimplePoint(t)&&(this.favorites.insert(i),this._registerForUpdateEvent(i,n)):t.AdditionalType==="category/Home"?i.createPointFromSimplePoint(t)&&(this.home=i,this.home.entity.setIsHomeOrWork("home")):t.AdditionalType==="category/Work"&&i.createPointFromSimplePoint(t)&&(this.work=i,this.work.entity.setIsHomeOrWork("work")));f=this._getCollectionIndexFromCache(u.favoritesCollectionId);f===this._invalidIndex&&(this._myPlaces||(this._myPlaces=new bt),this._myPlaces.collections.insert(n,0))}},i.prototype._registerForUpdateEvent=function(n,t){n.updated=new k;n.updated.add(function(i){o.makeCgAddPrimitiveRequest(t,n,function(r){n.entity.id=r.ItemId;r.ServerETag&&(t.eTag=r.ServerETag);i&&i(0)},function(n){i(n===0?0:9)},!0)})},i.prototype._removeHomeOrWork=function(n,t){var r=this,i=this._getCollectionIndexFromCache(u.keyPlacesCollectionId);i!==this._invalidIndex&&this._myPlaces.collections[i].eTag?this._sendDeletePrimitiveForHomeOrWork(n,this._myPlaces.collections[i],t):this.retrieveCollection(u.keyPlacesCollectionId,function(i,u){u===0&&i?r._sendDeletePrimitiveForHomeOrWork(n,i,t):t(u)})},i.prototype._sendDeletePrimitiveForHomeOrWork=function(n,t,i){o.makeCgDeletePrimitiveRequest(n.entity.id,t,function(n){n.ServerETag&&(t.eTag=n.ServerETag);i(0)},function(){i(9)})},i.prototype._updateHomeOrWork=function(n,t,i){var r=this;this._removeHomeOrWork(t,function(t){t===0?r.createFavorite(n,function(n,t){i(n,t)}):i(n,t)})},i._maxFavorites=1200,i._customCollectionsSynced=!1,i.instance=new i,i}(),kt=function(i){function r(){var t=this,r={};return t=i.call(this,r)||this,r.defineProperty("name",function(n,i){t._onNameChanged(n,i)}),r.defineProperty("originalName",function(n,i){t._onOriginalNameChanged(n,i)}),r.defineProperty("description",function(n,i){t._onDescriptionChanged(n,i)}),r.defineProperty("address",function(n,i){t._onAddressChanged(n,i)}),r.defineProperty("addressFields",function(n,i){t._onAddressFieldsChanged(n,i)}),r.defineProperty("phone",function(n,i){t._onPhoneChanged(n,i)}),r.defineProperty("businesslistingid",function(n,i){t._onBusinesslistingidChanged(n,i)}),r.defineProperty("photoUrl",function(n,i){t._onPhotoUrlChanged(n,i)}),r.defineProperty("url",function(n,i){t._onUrlChanged(n,i)}),r.defineProperty("geometry",function(n,i){t._onGeometryChanged(n,i)}),r.defineProperty("isHomeOrWork",function(n,i){t._onIsHomeOrWorkChanged(n,i)}),r.defineProperty("showOnMap",function(n,i){t._onShowOnMapChanged(n,i)}),r.defineProperty("iconText"),r.defineProperty("iconSource"),r.defineProperty("displayOrder"),t.id="",t._place=null,t.setIsHomeOrWork(""),n.useJsonApiForFavorites&&(t.updated=new k),t}return b(r,i),r.prototype.dispose=function(){i.prototype.dispose.call(this);this._place=null},r.prototype.getTitle=function(){switch(this.getIsHomeOrWork()){case"home":return a.L_HomeFavorite_Text;case"work":return a.L_WorkFavorite_Text;default:return this.getName()}},r.prototype.getPlace=function(){return this._place},r.prototype.getPlaceId=function(){return this._place?this._place.Id:(this._isBusiness=this._checkIsBusiness(this.getBusinesslistingid()),this.getBusinesslistingid()&&this.getBusinesslistingid()!=="0"?this.getBusinesslistingid().replace("ypid:","").replace("sid:",""):this.getGeometry()&&this.getGeometry().y+"_"+this.getGeometry().x)},r.prototype.createFavoriteFromCollectionEntity=function(n){n&&(this.id=n.id?n.id:n.entityId,this.setOriginalName(n.originalName),this.setName(n.name),!this.getName()&&this.getOriginalName()&&this.setName(this.getOriginalName()),this.setGeometry({x:n.labelLocation.longitude,y:n.labelLocation.latitude,bounds:[n.labelLocation.latitude,n.labelLocation.longitude,n.labelLocation.latitude,n.labelLocation.longitude]}),this.setAddress(n.address),this.setAddressFields(n.addressFields),this.setDescription(n.description),n.businesslistingid?this.setBusinesslistingid(n.businesslistingid):this.setBusinesslistingid(n.entityId),this.entityId=this.id,this.entityIdType=n.entityIdType,this.setPhotoUrl(n.photoUrl),this.segmentType=n.segmentType,this.categoryId=n.categoryId,this.setShowOnMap(!0),this.setDisplayOrder(n.displayOrder),this.updateCollectionEntityProperties(),this.createPlaceFromFavorite())},r.prototype.updateCollectionEntityProperties=function(){this.originalName=this.getOriginalName();this.address=this.getAddress();this.addressFields=this.getAddressFields();this.description=this.getDescription();this.businesslistingid=this.getBusinesslistingid();this.photoUrl=this.getPhotoUrl();this.displayOrder=this.getDisplayOrder()},r.prototype.ToCollectionEntity=function(){var i={name:this.getName(),originalName:this.getOriginalName(),description:this.getDescription(),address:this.getAddress(),addressFields:this.getAddressFields(),photoUrl:this.getPhotoUrl(),categoryId:this.categoryId},u=this.getGeometry(),r,n;return u&&(i.routableLocation=i.labelLocation=new l(u.y,u.x)),n=this.getBusinesslistingid(),n&&(n.indexOf("ypid:")!==-1||n.indexOf("sid:")!==-1?r=n:n!=="0"&&(t.hasSearchId(n)?r="ypid:"+n:n.split("_").length!==2&&(r="sid:"+n)),r&&(i.businesslistingid=n)),i},r.prototype.createFavoriteFromPlace=function(n){var i,r;n&&(n.Geometry||n.DisplayCoordinates)&&(n.Id&&(this.id=n.Id),n.Name&&this.setName(n.Name.Value),n.OriginalName&&this.setOriginalName(n.OriginalName.Value),!this.getName()&&this.getOriginalName()&&this.setName(this.getOriginalName()),n.Description&&this.setDescription(n.Description.Value),n.Address&&(n.Address.AddressSingleLine&&this.setAddress(n.Address.AddressSingleLine.Value),i={addressLine:n.Address.StreetAddress&&n.Address.StreetAddress.Value,city:n.Address.AddressLocality&&n.Address.AddressLocality.Value,stateMunicipality:n.Address.AddressRegion&&n.Address.AddressRegion.Value,country:n.Address.AddressCountry&&n.Address.AddressCountry.Value,neighborhood:"",postalCode:n.Address.PostalCode&&n.Address.PostalCode.Value,formattedAddress:this.getAddress()},this.setAddressFields(i)),n.Phone&&this.setPhone(n.Phone.Value),n.BingEntityId&&(r=t.addIdPrefix(n.BingEntityId.Value),this.setBusinesslistingid(r)),n.BusinessType&&(this.categoryId=n.BusinessType.Value),n.ImageUri&&this.setPhotoUrl(n.ImageUri.Value),n.Url&&this.setUrl(n.Url.Value),n.ShowOnMap?this.setShowOnMap(n.ShowOnMap.Value):this.setShowOnMap(!0),n.Geometry?n.Geometry.Longitude&&n.Geometry.Latitude&&this.setGeometry({x:n.Geometry.Longitude.Value,y:n.Geometry.Latitude.Value,bounds:[n.Geometry.Latitude.Value,n.Geometry.Longitude.Value,n.Geometry.Latitude.Value,n.Geometry.Longitude.Value]}):n.DisplayCoordinates&&n.DisplayCoordinates.Longitude&&n.DisplayCoordinates.Latitude&&this.setGeometry({x:n.DisplayCoordinates.Longitude.Value,y:n.DisplayCoordinates.Latitude.Value,bounds:[n.DisplayCoordinates.Latitude.Value,n.DisplayCoordinates.Longitude.Value,n.DisplayCoordinates.Latitude.Value,n.DisplayCoordinates.Longitude.Value]}),n.DisplayOrder&&this.setDisplayOrder(n.DisplayOrder.Value),this._place=n)},r.prototype.createPlaceFromFavorite=function(){var r,t,u,i;if(!this._place){if(n.useJsonApiForFavorites)return this._place=this._createJsonApiPlaceFromFavorite(),this._place;r=this.getPlaceId();t=graph.Me.Preferences.Favorites.Collections.Default.CreatePlace(r);t.Id&&(this.id=t.Id);this.getName()&&(t.Name=graph.CreateText(this.getName()));u=this.getOriginalName()?this.getOriginalName():this.getName();u&&(t.OriginalName=graph.CreateText(u));this.getDescription()&&(t.Description=graph.CreateText(this.getDescription()));this.getAddress()&&(t.Address=graph.CreateTyped(graph.Entities.PostalAddress,r),t.Address.AddressSingleLine=graph.CreateText(this.getAddress()),i=this.getAddressFields(),i&&!n.useJsonApiForFavorites&&(t.Address.AddressLocality=graph.CreateText(i.city),t.Address.AddressRegion=graph.CreateText(i.stateMunicipality),t.Address.AddressCountry=graph.CreateText(i.country),t.Address.PostalCode=graph.CreateText(i.postalCode),t.Address.StreetAddress=graph.CreateText(i.addressLine)));this.getPhone()&&(t.Phone=graph.CreateText(this.getPhone()));r&&(t.BingEntityId=graph.CreateText(r));this._isBusiness&&(t.IsBusiness=graph.Create(!0));this.categoryId&&(t.BusinessType=graph.CreateText(this.categoryId));this.getPhotoUrl()&&(t.ImageUri=graph.CreateText(this.getPhotoUrl()));this.getUrl()&&(t.Url=graph.CreateText(this.getUrl()));this.getGeometry()&&(t.DisplayCoordinates=graph.CreateGeometryPoint(this.getGeometry().y,this.getGeometry().x));this._place=t}return this._place},r.prototype.removePlace=function(){if(this._place){var t=this._place;this._place=null;n.useJsonApiForFavorites||graph.Me.Preferences.Favorites.Collections.Default.Members.Remove(t);n.useJsonApiForFavorites||t.Delete()}},r.prototype._onNameChanged=function(t,i){var r=this;this.name=this.getTitle();this._updatePlaceFields(function(t){t&&(r._place.Name=n.useJsonApiForFavorites?{Value:i}:graph.CreateText(i))})},r.prototype._onOriginalNameChanged=function(t,i){var r=this;this.originalName=this.getOriginalName();this._updatePlaceFields(function(t){t&&(r._place.OriginalName=n.useJsonApiForFavorites?{Value:i}:graph.CreateText(i))})},r.prototype._onDescriptionChanged=function(t,i){var r=this;this.description=this.getDescription();this._updatePlaceFields(function(t){t&&(r._place.Description=n.useJsonApiForFavorites?{Value:i}:graph.CreateText(i))})},r.prototype._onAddressChanged=function(t,i){var r=this;this.address=this.getAddress();this._updatePlaceFields(function(t){t&&(r._place.Address||n.useJsonApiForFavorites||(r._place.Address=graph.CreateTyped(graph.Entities.PostalAddress,r._place.BingEntityId.Value)),r._place.Address.AddressSingleLine=n.useJsonApiForFavorites?{Value:i}:graph.CreateText(i))})},r.prototype._onAddressFieldsChanged=function(t,i){var r=this;this.addressFields=this.getAddressFields();this._updatePlaceFields(function(t){t&&(r._place.Address||n.useJsonApiForFavorites||(r._place.Address=graph.CreateTyped(graph.Entities.PostalAddress,r._place.BingEntityId.Value)),r._place.Address.AddressLocality=n.useJsonApiForFavorites?{Value:i.city}:graph.CreateText(i.city),r._place.Address.AddressRegion=n.useJsonApiForFavorites?{Value:i.stateMunicipality}:graph.CreateText(i.stateMunicipality),r._place.Address.AddressCountry=n.useJsonApiForFavorites?{Value:i.country}:graph.CreateText(i.country),r._place.Address.PostalCode=n.useJsonApiForFavorites?{Value:i.postalCode}:graph.CreateText(i.postalCode),r._place.Address.StreetAddress=n.useJsonApiForFavorites?{Value:i.addressLine}:graph.CreateText(i.addressLine))})},r.prototype._onPhoneChanged=function(t,i){var r=this;this.phone=this.getPhone();this._updatePlaceFields(function(t){t&&(r._place.Phone=n.useJsonApiForFavorites?{Value:i}:graph.CreateText(i))})},r.prototype._onBusinesslistingidChanged=function(t,i){var r=this;this.businesslistingid=this.getBusinesslistingid();this._updatePlaceFields(function(t){if(t){r._isBusiness=r._checkIsBusiness(i);r._isBusiness&&(r._place.IsBusiness=graph.Create(!0));var u=i.replace("ypid:","").replace("sid:","");r._place.BingEntityId=n.useJsonApiForFavorites?{Value:u}:graph.CreateText(u)}})},r.prototype._onPhotoUrlChanged=function(t,i){var r=this;this.photoUrl=this.getPhotoUrl();this._updatePlaceFields(function(t){t&&(r._place.ImageUri=n.useJsonApiForFavorites?{Value:i}:graph.CreateText(i))})},r.prototype._onUrlChanged=function(t,i){var r=this;this.url=this.getUrl();this._updatePlaceFields(function(t){t&&(r._place.Url=n.useJsonApiForFavorites?{Value:i}:graph.CreateText(i))})},r.prototype._onGeometryChanged=function(t,i){var r=this;this.geometry=this.getGeometry();this._updatePlaceFields(function(t){t&&(r._place.Geometry=n.useJsonApiForFavorites?{Latitude:{Value:i.y},Longitude:{Value:i.x}}:graph.CreateGeometryPoint(i.y,i.x),r._place.DisplayCoordinates=r._place.Geometry)})},r.prototype._onIsHomeOrWorkChanged=function(n,t){this.name=this.getTitle();this.homeOrWork=t},r.prototype._onShowOnMapChanged=function(t,i){var r=this;this.showOnMap=this.getShowOnMap();this._updatePlaceFields(function(t){t&&(r._place.ShowOnMap=n.useJsonApiForFavorites?{Value:i}:graph.Create(i))})},r.prototype._updatePlaceFields=function(t){if(this._place&&(typeof graph!="undefined"||n.useJsonApiForFavorites)){var i=function(i){t(i===200);n.useJsonApiForFavorites||ht.ensureGraphCommit()};e.getFunctionalTestHooksEnabled()?i(200):n.useJsonApiForFavorites?this.updated.invoke(i):ht.ensureGraphCommit(i);return}t(!1)},r.prototype._checkIsBusiness=function(n){return n&&(n.indexOf("ypid:")!==-1||t.hasSearchId(n)&&n.indexOf("sid:")===-1)},r.prototype._createJsonApiPlaceFromFavorite=function(){var n=new ir,t,i;return n.Id=this.getPlaceId(),this.id=n.Id,n.IsEntity=!0,this.getName()&&(n.Name={Value:this.getName()}),this.getOriginalName()&&(n.OriginalName={Value:this.getOriginalName()}),this.getDescription()&&(n.Description={Value:this.getDescription()}),t=this.getAddressFields(),t&&(n.Address={AddressSingleLine:{Value:t.formattedAddress},StreetAddress:{Value:t.addressLine},PostalCode:{Value:t.postalCode},AddressRegion:{Value:t.stateMunicipality},AddressLocality:{Value:t.city},AddressCountry:{Value:t.country}}),this.getPhone()&&(n.Phone={Value:this.getPhone()}),n.IsBusiness={Value:this._isBusiness},n.Id&&(n.BingEntityId={Value:n.Id}),this.categoryId&&(n.BusinessType={Value:this.categoryId}),this.getPhotoUrl()&&(n.ImageUri={Value:this.getPhotoUrl()}),this.getUrl()&&(n.Url={Value:this.getUrl()}),i=this.getGeometry(),i&&(n.DisplayCoordinates={Latitude:{Value:i.y},Longitude:{Value:i.x}}),n},r}(it),di=function(){function t(n){if(t._instance)return t._instance;this.labeledCollection=new u("labeled",a.AutoCollections_LabeledPlaces,!0);this.nearHomeCollection=new u("nearHome",a.AutoCollections_NearHome,!0);this.nearWorkCollection=new u("nearWork",a.AutoCollections_NearWork,!0);this.nearbyCollections=new c;this._reverseGeocoder=n;t._instance=this}return t.prototype.generateAutoCollections=function(n,t,i){n&&!this.favorites&&(this.favorites=n);t&&!this.home&&(this.home=t);i&&!this.work&&(this.work=i);this._generateLabeledCollection();this._generateNearHomeCollection();this._generateNearWorkCollection();this._generateClusteredCityCollections();this._updateImageUrls()},t.prototype._generateLabeledCollection=function(){var n,r,t,i;for(this.labeledCollection.primitives.clear(),this.home&&this.labeledCollection.primitives.insert(this.home),this.work&&this.labeledCollection.primitives.insert(this.work),n=0,r=this.favorites.length;n<r;n++)t=this.favorites[n],i=t.entity,i.getName()!==i.getOriginalName()&&this.labeledCollection.primitives.insert(t)},t.prototype._generateNearHomeCollection=function(){if(this.nearHomeCollection.primitives.clear(),this.home){var n=this.home.geometry,t=new l(n.y,n.x);this._populateNearHomeOrWorkCollection(this.nearHomeCollection,t)}},t.prototype._generateNearWorkCollection=function(){if(this.nearWorkCollection.primitives.clear(),this.work){var n=this.work.geometry,t=new l(n.y,n.x);this._populateNearHomeOrWorkCollection(this.nearWorkCollection,t)}},t.prototype._populateNearHomeOrWorkCollection=function(t,i){for(var r=0,u=this.favorites.length;r<u;r++){var f=this.favorites[r],e=f.geometry,o=new l(e.y,e.x),s=ft.greatCircleDistance(o,i);s<n.nearHomeWorkDistance&&t.primitives.insert(f)}},t.prototype._generateClusteredCityCollections=function(){var i,r,t,u;for(this.nearbyCollections.clear(),this._seedInitialClusters(),i=!0,r=0;i&&r<n.maxIterations;)i=this._iterateCluster(),r++;for(this._pruneClusters(),t=0;t<this.nearbyCollections.length;t++)u=this.nearbyCollections[t],u.collection.id="nearby"+t,this._setClusterName(u)},t.prototype._seedInitialClusters=function(){for(var n,i,r,t=0,f=this.favorites.length;t<f;t++)if(n=this.favorites[t],i=this._findClosestCluster(n),i)this._insertAndUpdateCenterpoint(i,n);else{r=new u("nearby"+this.nearbyCollections.length,a.AutoCollections_Nearby.replace("{0}",n.entity.getName()),!0);r.primitives.insert(n);var e=n.geometry,o=new l(e.y,e.x),s={centerpoint:o,collection:r};this.nearbyCollections.insert(s)}},t.prototype._iterateCluster=function(){for(var n,t,i,u,f=!1,r=this.nearbyCollections.length-1;r>=0;r--)for(n=this.nearbyCollections[r],t=n.collection.primitives.length-1;t>=0;t--)i=n.collection.primitives[t],u=this._findClosestCluster(i,n),u&&(this._insertAndUpdateCenterpoint(u,i),n.collection.primitives.remove(i),f=!0);return f},t.prototype._pruneClusters=function(){for(var t,i=this.nearbyCollections.length-1;i>=0;i--)t=this.nearbyCollections[i],t.collection.primitives.length<n.minimumClusterSize&&(t.collection.primitives.clear(),this.nearbyCollections.remove(t),t.collection.dispose(),t.collection=null,t.centerpoint=null)},t.prototype._findClosestCluster=function(t,i){for(var o,u,s=t.geometry,h=new l(s.y,s.x),f=-1,e=-1,r=0,c=this.nearbyCollections.length;r<c;r++)(o=this.nearbyCollections[r],o!==i)&&(u=ft.greatCircleDistance(h,o.centerpoint),u<n.maxNearbyDistance&&(f===-1||u<f)&&(f=u,e=r));return e===-1?null:this.nearbyCollections[e]},t.prototype._insertAndUpdateCenterpoint=function(n,t){n.collection.primitives.insert(t);n.centerpoint=this._computeCenterpoint(n.collection.primitives)},t.prototype._computeCenterpoint=function(n){var t=r.SpatialMath,i=t.Geometry;return i.centroid(n.slice())},t.prototype._setClusterName=function(n){this._reverseGeocoder.reverseGeocodeWithNetworkId(n.centerpoint,function(t){t&&t.addressList&&t.addressList.length>0&&(n.collection.name=a.AutoCollections_Nearby.replace("{0}",t.addressList[0].locality||t.addressList[0].adminDistrict2),n.collection.changed.invoke())},["PopulatedPlace","Postcode1","AdminDivision1","AdminDivision2"])},t.prototype._updateImageUrls=function(){this._addImagesToCollectionMeta(this.labeledCollection);this._addImagesToCollectionMeta(this.nearHomeCollection);this._addImagesToCollectionMeta(this.nearWorkCollection);for(var n=0,t=this.nearbyCollections.length;n<t;n++)this._addImagesToCollectionMeta(this.nearbyCollections[n].collection)},t.prototype._addImagesToCollectionMeta=function(n){for(var u,i,r=n.collageImages.length,t=0,f=n.primitives.length;t<f&&r<3;t++)u=n.primitives[t],i=u.entity.getPhotoUrl(),i&&(n.collageImages.insert(i),r++)},t}(),nt=function(){function n(){}return n.convertTravelItineraryToItineraryCollection=function(t){var f,i,h,e,c,o,r,l,u,a,s;if(!t)return null;if(f=t.Days?t.Days.length:0,i={$type:"ItineraryCollection",Name:t.Name,CollectionId:t.CollectionId,Description:t.Description,ItineraryDays:f||t.DayCount,Properties:{ItineraryDays:f||t.DayCount},InterestTypes:t.InterestTypes,Url:t.SeeAllPoisUrl,Image:t.Image&&t.Image.Url,ETag:t.ETag,ItineraryMetaETag:t.ItineraryMetaETag,CanShare:!0,Items:[],Version:typeof t.Version!="undefined"?t.Version:0},t.CollageImages)if(Array.isArray(t.CollageImages))i.Properties.ImageUrls=w.Internals.stringify(t.CollageImages.slice());else{for(h=[],e=0;e<t.CollageImages.length;e++)h.push(t.CollageImages[e]);i.Properties.ImageUrls=w.Internals.stringify(h)}if(t.ItineraryExtraInfo&&t.ItineraryExtraInfo.Highlights&&(i.Properties.HighlightText=t.ItineraryExtraInfo.Highlights),t.ItineraryAttractions&&(i.Properties.AttractionNames=w.Internals.stringify(t.ItineraryAttractions.slice())),t.gettyID&&(i.Properties.GettyId=t.gettyID,i.Properties.Photographer=t.photographer),t.ItineraryExtraInfo&&t.ItineraryExtraInfo.Highlights&&(i.Properties.HighlightText=t.ItineraryExtraInfo.Highlights),t.startDate&&(i.Properties.StartDate=""+t.startDate),t.endDate&&(i.Properties.EndDate=""+t.endDate),t.Destinations&&t.Destinations.length){for(c=[],o=0;o<t.Destinations.length;o++)c.push(n.convertTravelItemToPlace(t.Destinations[o]));i.Properties.Destinations=w.Internals.stringify(c)}for(r=0;r<f;r++)for(l=t.Days[r],u=0;u<l.length;u++)a=l[u],s=n.convertTravelItemToPlace(a),s.ItineraryInformation.DayIndex=r+1,s.DisplayOrder=u,i.Items.push(s);return i.ItemsCount=i.Items.length,i},n.convertTravelItemToPlace=function(n){var u={$type:"GeometryPoint",Latitude:n.Lat,Longitude:n.Lon},f={InterestTypes:n.InterestTypes,StayDurationInMinutes:n.StayDurationInMinutes,TimeToNextInSeconds:n.TimeToNext,KmToNext:n.KmToNext,ModeToNext:n.ModeToNext,DayIndex:n.DayIndex+1},i={$type:"Place",RoutableCoordinates:u,DisplayCoordinates:u,Geometry:u,ShowOnMap:!0,Name:n.Name,OriginalName:n.OriginalName||n.Name,Description:n.Description,Image:n.Image&&n.Image.Url,ItineraryInformation:f,ItemId:n.CloudGraphId,DisplayOrder:n.ItemIndex,BusinessType:n.CategoryId},r;return n.EntityTypes&&n.EntityTypes.length&&(i.EntityType=n.EntityTypes[0]),r=n.Id,t.hasSatoriId(r)?(i.EntityIdType="SatoriID",i.EntityId=r):t.hasSearchId(r)&&(i.EntityIdType="YPID",i.EntityId=r),i},n.convertItineraryCollectionToTravelItinerary=function(t){var s,i,f,h,c,e,l,v,o,u,r;if(!t)return null;if(s=t.ItineraryDays||t.Properties.ItineraryDays,i={Image:{Url:t.Image},InterestTypes:t.InterestTypes,Name:t.Name,CollectionId:t.CollectionId,SeeAllPoisUrl:t.Url,Description:t.Description,ETag:t.ETag,ItineraryMetaETag:t.ItineraryMetaETag,GuideUrl:"",DayCount:s,AttractionCount:t.ItemsCount,Days:[],Version:t.Version},t.Properties.HighlightText&&(i.ItineraryExtraInfo={Highlights:t.Properties.HighlightText,StateName:null,ImageUrls:null}),this.listFromStringToObservable("collage",t,i),this.listFromStringToObservable("attractions",t,i),t.Properties.GettyId&&(i.gettyID=t.Properties.GettyId,i.photographer=t.Properties.Photographer),t.Properties.StartDate&&(i.startDate=parseInt(t.Properties.StartDate)),t.Properties.EndDate&&(i.endDate=parseInt(t.Properties.EndDate)),f=t.Properties.Destinations,f&&f.length){for(h=w.Internals.parseJSON(f),c=[],e=0;e<h.length;e++)c.push(n.convertPlaceToTravelItem(h[e]));i.Destinations=c}for(l=0;l<s;l++)i.Days.push([]);for(v=t.Items?t.Items.length:0,o=0;o<v;o++){for(var y=t.Items[o],a=n.convertPlaceToTravelItem(y),p=y.ItineraryInformation.DayIndex-1;p>=i.Days.length;)i.Days.push([]);if(u=i.Days[p],u){for(r=0;r<a.ItemIndex;)if(u[r]&&u[r].ItemIndex<a.ItemIndex)r++;else break;u.splice(r,0,a)}}return i},n.listFromStringToObservable=function(n,t,i){var f=t.Properties&&(n==="collage"?t.Properties.ImageUrls:t.Properties.AttractionNames),e,r,u;if(f&&f.length){for(e=w.Internals.parseJSON(f),r=new c,u=0;u<e.length;u++)r.insert(e[u]);n==="collage"?i.CollageImages=r:i.ItineraryAttractions=r}},n.convertPlaceToTravelItem=function(n){var t=n.Geometry,i={Name:n.Name,OriginalName:n.OriginalName||n.Name,Description:n.Description,Id:n.EntityId,Lat:t&&t.Latitude,Lon:t&&t.Longitude,Image:{Url:n.Image},InterestTypes:n.ItineraryInformation.InterestTypes,StayDurationInMinutes:n.ItineraryInformation.StayDurationInMinutes,TimeToNext:n.ItineraryInformation.TimeToNextInSeconds,KmToNext:n.ItineraryInformation.KmToNext,ModeToNext:n.ItineraryInformation.ModeToNext,CloudGraphId:n.ItemId,ItemIndex:n.DisplayOrder,CategoryId:n.BusinessType};return n.EntityType&&(i.EntityTypes=[n.EntityType]),i},n}(),tt=function(t){function i(){return t!==null&&t.apply(this,arguments)||this}return b(i,t),i.makeRetrieveAllItinerariesMetadataRequest=function(t,i){var u={RequestType:1,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,CollectionType:"ItineraryCollection"},r=null;e.getFunctionalTestHooksEnabled()&&(r=n.retrieveAllItinerariesBag);o._makeCgRequest(t,i,u,r)},i.makeRetrieveItineraryRequest=function(t,i,r,u,f){var h={RequestType:f?10:3,CollectionId:t,ClientETag:i,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,CollectionType:"ItineraryCollection"},s;f&&(h.ExternalUserId=f);s=null;e.getFunctionalTestHooksEnabled()&&(s=n.retrieveItineraryBag);o._makeCgRequest(r,u,h,s)},i.makeCreateItineraryRequest=function(t,i,r){var f={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:"0",ItineraryMetaClientETag:"0",CollectionToBeWritten:t,MetaToBeWritten:{},CollectionType:"ItineraryCollection"},u=null;e.getFunctionalTestHooksEnabled()&&(u=n.insertItineraryBag);o._makeCgRequest(i,r,f,u)},i.makeUpdateItineraryRequest=function(t,i,r){var f={RequestType:5,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,CollectionToBeWritten:t,CollectionType:"ItineraryCollection"},u=null;e.getFunctionalTestHooksEnabled()&&(u=n.updateItineraryBag);o._makeCgRequest(i,r,f,u)},i.makeUpdateItineraryMetadataRequest=function(t,i,r){t.Items=null;var f={RequestType:6,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,MetaToBeWritten:t,CollectionType:"ItineraryCollection"},u=null;e.getFunctionalTestHooksEnabled()&&(u=n.updateItineraryMetaBag);o._makeCgRequest(i,r,f,u)},i.makeDeleteItineraryRequest=function(t,i,r){var f={RequestType:7,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,CollectionType:"ItineraryCollection"},u=null;e.getFunctionalTestHooksEnabled()&&(u=n.deleteItineraryBag);o._makeCgRequest(i,r,f,u)},i.makeItineraryUpsertPrimitiveRequest=function(t,i,r,u,f){if(i){var s={RequestType:4,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:t.ETag,ItineraryMetaClientETag:t.ItineraryMetaETag,CollectionId:t.CollectionId,ItemToBeWritten:i,CollectionType:"ItineraryCollection"},h=null;e.getFunctionalTestHooksEnabled()&&(h=n.insertItineraryItemBag);f&&(s.ItemId=i.ItemId);o._makeCgRequest(r,u,s,h)}},i.makeItineraryDeletePrimitiveRequest=function(t,i,r,u){var s={RequestType:8,RequestOrigin:n.cgApiRequestOrigin,SchemaVersion:n.cgApiSchemaVersion,ClientETag:i.ETag,ItineraryMetaClientETag:i.ItineraryMetaETag,CollectionId:i.CollectionId,ItemId:t,CollectionType:"ItineraryCollection"},f=null;e.getFunctionalTestHooksEnabled()&&(f=n.deleteItineraryItemBag);o._makeCgRequest(r,u,s,f)},i}(o),vt=function(n){function t(){return t.itineraryInstance?t.itineraryInstance:n.call(this,!0)||this}return b(t,n),t.prototype.retrieveAllItinerariesMetaData=function(n){var t=this;this._itineraries&&this._itinerariesRetrieved?n&&n(this._itineraries,0):tt.makeRetrieveAllItinerariesMetadataRequest(function(i){t._handleItineraryRetrieveAllResponse(i,n)},function(i,r,u){r===null||r.CollectionsMetaMap?n&&n(null,i?9:0):t._handleItineraryRetrieveAllResponse(r,n,u)})},t.prototype.retrieveItinerary=function(n,t,i){var u=this,r,f,e,o;!n&&t?t(null,7):(r=this.getItineraryIndexFromCache(n),f=null,r!==this._invalidIndex&&this._itineraries[r].itemsRetrieved&&(f=this._itineraries[r].eTag),e=function(n){return u._handleSingleItineraryResponse(n,t)},o=function(n,i){i!==null&&i.CollectionsMap?u._handleSingleItineraryResponse(i,t):n===0?t&&t(u._itineraries[r],0):t&&t(null,n?9:0)},tt.makeRetrieveItineraryRequest(n,f,e,o,i))},t.prototype.createItinerary=function(n,t){var i=this,r,u;!n&&t?t(null,7):(r=this.getItineraryIndexFromCache(n.collectionId),this._itineraries&&this._itineraries.length>=ht._getMaxAllowedCollections()?t&&t(null,2):r===this._invalidIndex?(this._compareItineraryNames(n),u=nt.convertTravelItineraryToItineraryCollection(rt.serialize(n)),tt.makeCreateItineraryRequest(u,function(r){var e,u,s,o,f,h,l;for(i._itineraries||(i._itineraries=new c),n.collectionId=r.CollectionId,n.eTag=r.ServerETag,n.itineraryMetaETag=r.ItineraryMetaServerETag,n.itemsRetrieved=!0,n.externalUserId=r.ExternalUserId,e=n.getDays(),u=0,s=e.length;u<s;u++)for(o=e[u],f=0,h=o.length;f<h;f++)l=o[f],l.setCollectionId(r.CollectionId);i._itineraries.insert(n,0);ut.instance.pushItinerary(n);t(n,0)},function(n){t&&t(null,n?9:0)})):t&&t(null,8))},t.prototype.deleteItinerary=function(n,t){var f=this,r,i,u;!n&&t?t(7):(r=this.getItineraryIndexFromCache(n),r!==this._invalidIndex?(i=this._itineraries[r],u=nt.convertTravelItineraryToItineraryCollection(rt.serialize(i)),tt.makeDeleteItineraryRequest(u,function(){ut.instance.removeItinerary(i);i.collectionId="";i.changed.invoke();f._itineraries.removeAt(r);t(0)},function(n){t&&t(n?9:0)})):t&&t(5))},t.prototype.updateItinerary=function(n,t){var u=this,i,r;!n&&t?t(null,7):(i=this.getItineraryIndexFromCache(n.collectionId),r=nt.convertTravelItineraryToItineraryCollection(rt.serialize(n)),tt.makeUpdateItineraryRequest(r,function(n){return u._handleUpdateItineraryResponse(n,t,i)},function(n){t&&t(null,n?9:0)}))},t.prototype.updateItineraryMeta=function(n,t){var u=this,i,r;!n&&t?t(null,7):(i=this.getItineraryIndexFromCache(n.collectionId),r=nt.convertTravelItineraryToItineraryCollection(rt.serialize(n)),tt.makeUpdateItineraryMetadataRequest(r,function(n){var r=function(n){var i=function(i){i.ServerETag&&(n.eTag=i.ServerETag);i.ItineraryMetaServerETag&&(n.itineraryMetaETag=i.ItineraryMetaServerETag);t&&t(n,0)},r=function(n){t&&t(null,n?9:0)};tt.makeRetrieveItineraryRequest(n.collectionId,n.eTag,i,r)};return u._handleUpdateItineraryResponse(n,r,i)},function(n){t&&t(null,n?9:0)}))},t.prototype.addItineraryItem=function(n,t,i){var u,r,f;if(i){if(n){if(!t){i(null,10);return}}else{i(null,7);return}if(u=this.getItineraryIndexFromCache(n),u===this._invalidIndex){i(null,5);return}if(r=this._itineraries[u],r.itemsRetrieved&&r.getAttractionCount()>=ht._getMaxAllowedCollectionEntites()){i(null,3);return}f=nt.convertTravelItineraryToItineraryCollection(rt.serialize(r));tt.makeItineraryUpsertPrimitiveRequest(f,nt.convertTravelItemToPlace(t.getItineraryItemMeta()),function(n){t.cloudGraphId=n.ItemId;n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);ut.instance.pushItinerary(r);i&&i(r,0,n.ItemId)},function(n){i(null,n===0?0:9)})}},t.prototype.deleteItineraryItem=function(n,t,i){if(i){if(!n){i(7);return}if(!t){i(10);return}var u=this.getItineraryIndexFromCache(n),r=this._itineraries[u],f=nt.convertTravelItineraryToItineraryCollection(rt.serialize(r));tt.makeItineraryDeletePrimitiveRequest(t,f,function(n){n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);i(0)},function(){i(9)})}},t.prototype.updateItineraryItem=function(n,t,i){if(i){if(!n){i(7);return}if(!t){i(10);return}var u=this.getItineraryIndexFromCache(n),r=this._itineraries[u],f=nt.convertTravelItineraryToItineraryCollection(rt.serialize(r));tt.makeItineraryUpsertPrimitiveRequest(f,nt.convertTravelItemToPlace(t.getItineraryItemMeta()),function(n){n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);i&&i(0)},function(n){i(n===0?0:9)},!0)}},t.prototype._handleItineraryRetrieveAllResponse=function(n,t,i){var u=new c,f=n&&n.CollectionsMetaMap,e,h,r;if(f){for(e in f)if(f.hasOwnProperty(e)){var o=f[e],l=nt.convertItineraryCollectionToTravelItinerary(o),s=this.getItineraryIndexFromCache(o.CollectionId);s!==this._invalidIndex?(h=this._itineraries[s],u.insert(h)):(r=new rt(l),r&&(r.externalUserId=n.ExternalUserId,r.eTag="",r.itineraryMetaETag=o.ETag,u.insert(r)))}this._itinerariesRetrieved=!0;this._itineraries=u;t&&t(this._itineraries,0)}else n&&i===404?(this._itinerariesRetrieved=!0,this._itineraries=u,t&&t(this._itineraries,0)):t&&t(this._itineraries,9)},t.prototype._handleSingleItineraryResponse=function(n,t){var u=n.CollectionsMap,r=u[n.CollectionId],f,e,i,o;if(!r)for(f in u)if(u.hasOwnProperty(f)){r=u[f];break}if(this._itineraries||(this._itineraries=new c),e=this.getItineraryIndexFromCache(r.CollectionId),r&&(o=nt.convertItineraryCollectionToTravelItinerary(r),e!==this._invalidIndex?(i=this._itineraries[e],i.deserializeItineraryProperties(o)):(i=new rt(o),this._itineraries.insert(i))),!i){t&&t(null,5);return}i.externalUserId=n.ExternalUserId;i.eTag=n.ServerETag;i.itineraryMetaETag=n.ItineraryMetaServerETag;t&&t(i,0)},t.prototype._handleUpdateItineraryResponse=function(n,t,i){var r=this._itineraries[i];n.ServerETag&&(r.eTag=n.ServerETag);n.ItineraryMetaServerETag&&(r.itineraryMetaETag=n.ItineraryMetaServerETag);t&&t(r,0)},t.prototype.getItineraryIndexFromCache=function(n){var i=this._invalidIndex,r,t,u;if(n&&this._itineraries)for(r=this._itineraries.length,t=0;t<r;t++)if(u=this._itineraries[t],u.collectionId.toLowerCase()===n.toLowerCase()){i=t;break}return i},t.prototype._compareItineraryNames=function(n){var e=this._invalidIndex,r,i,t,u,f;if(n&&this._itineraries)for(r=1,i=n.getName(),t=0,u=this._itineraries.length;t<u;t++)f=this._itineraries[t],f.getName().indexOf(i)!==-1&&n.setName(i+" "+ ++r)},t.itineraryInstance=new t,t}(ht),ut=function(){function n(){if(n.instance)return n.instance;this._mostRecentlyUsed=new c}return n.prototype.pushItinerary=function(n){var t={IsItinerary:!0,Itinerary:n};this._dedupeItem(t);this._pushItem(t);this._trimList()},n.prototype.pushCollection=function(n){var t={IsItinerary:!1,Collection:n};this._dedupeItem(t);this._pushItem(t);this._trimList()},n.prototype.removeCollection=function(n){for(var i,t=0,r=this._mostRecentlyUsed.length;t<r;t++)if(i=this._mostRecentlyUsed[t],!i.IsItinerary&&i.Collection.id===n.id){this._mostRecentlyUsed.removeAt(t);break}},n.prototype.pushOpenItinerary=function(n,t,i){var r={IsItinerary:!0,IsOpenTask:!0,TaskId:n,TaskTitle:t,ItineraryCollectionId:i};this._dedupeItem(r);this._pushItem(r);this._trimList()},n.prototype.removeItinerary=function(n){for(var i,t=0,r=this._mostRecentlyUsed.length;t<r;t++)if(i=this._mostRecentlyUsed[t],i.IsItinerary&&i.Itinerary.collectionId===n.collectionId){this._mostRecentlyUsed.removeAt(t);break}},n.prototype.removeOpenItinerary=function(n){for(var i,t=0,r=this._mostRecentlyUsed.length;t<r;t++)if(i=this._mostRecentlyUsed[t],i.IsOpenTask&&i.TaskId===n){this._mostRecentlyUsed.removeAt(t);break}},n.prototype.getLength=function(){return this._mostRecentlyUsed.length},n.prototype.getList=function(){return this._mostRecentlyUsed.slice()},n.prototype._pushItem=function(n){this._mostRecentlyUsed.insert(n,0)},n.prototype._dedupeItem=function(n){for(var i,r=n.IsItinerary,u=n.IsOpenTask,t=0,f=this._mostRecentlyUsed.length;t<f;t++)if(i=this._mostRecentlyUsed[t],r&&!u&&i.Itinerary===n.Itinerary||!r&&i.Collection===n.Collection){this._mostRecentlyUsed.removeAt(t);break}},n.prototype._trimList=function(){var n=this._mostRecentlyUsed.length;n>3&&this._mostRecentlyUsed.removeAt(3,n-3)},n.instance=new n,n}(),i=function(){function n(){}return n.id="id",n.ypid="ypid",n.sid="sid",n.eventId="eventId",n.nameField="name",n.description="description",n.address="address",n.isPublic="isPublic",n.entity="entity",n.primitives="primitives",n.geometry="geometry",n.geometryType="geometryType",n.geometryLongitudes="x",n.geometryLatitudes="y",n.bounds="bounds",n.area="area",n.style="style",n.displayOrder="displayOrder",n.routableLocation="routableLocation",n.labelLocation="labelLocation",n.photoId="photoId",n.photoUrl="photourl",n.businesslistingid="businesslistingid",n.serviceEndPoint="{ServiceEndPoint}",n.market="{Market}",n.collectionId="{CollectionId}",n.entityId="{EntityId}",n.logFeatureName="CX",n.defaultStyle={fillStyle:"rgba(189, 213, 245, .3)",strokeStyle:"#00ff00",lineWidth:6,dashes:[0]},n.latLongPrecision=6,n}(),v=function(){function n(){}return n.viewMyPlaces="VMP",n.viewCollection="VCO",n.viewCollectionItemDetails="VCID",n.viewTemporaryCollection="VTC",n.processCollections="PC",n.viewAddNewCollection="VANC",n.newCollectionSave="NCS",n.saveButtonClicked="SBC",n.deleteButtonClicked="DBC",n.saveTemporaryCollection="STC",n.temporaryCollectionStatus="TCS",n.editCollection="ECO",n.editMyPlaces="EMP",n.routeCollection="RC",n.privacySharingState="PSS",n.itemCounts="CNT",n.favorites="FAV",n.pdpRequestFailure="PDPERR",n.seeAllCollectionClick="SAC",n.viewUpcomingEvents="VUE",n.loadUpcomingEvents="LUE",n.hasHomeWork="HWS",n.clickEntity="CE",n.SaveOnSerpClick="SOSC",n.OneClickSaveChangeClick="OCSC",n}(),gi=function(){function n(){}return n.getCollections="GC",n.getCollectionList="GCL",n.getCollectionDetails="GCD",n.loadMyPlacesView="LMPV",n.loadCollectionEntitiesView="LCEV",n.loadCollectionDetailsView="LCDV",n.renderCollectionPois="RCP",n.getFavorites="GFL",n}(),s=function(){function r(n,i,r){this.description=r;this.id=n;this.name=i;this.originalName=i;this.dateCreated=t.convertJavascriptDateToDateInTicks(new Date);this.dateModified=this.dateCreated;this.dateAccessed=this.dateCreated;this.addressFields={addressLine:"",formattedAddress:"",city:"",stateMunicipality:"",country:"",postalCode:"",neighborhood:""}}return r.deserialize=function(n){var t;return n&&n.id&&n.name&&(t=new r(n.id,n.name,n.description),t.displayOrder=n.displayOrder,t.routableLocation=n.routableLocation,t.routableLocation||(t.routableLocation=new l(0,0)),t.labelLocation=n.labelLocation,t.photoId=n.photoId,t.photoUrl=n.photoUrl||n[i.photoUrl],t.businesslistingid=n.businesslistingid,t.address=n.address,t.originalName=n.originalName),t},r.deserializeCgEntity=function(u,f){var o=u.Name?u.Name:u.OriginalName,e;if(f||(f=new r(u.ItemId,o,u.Description)),u.OriginalName&&(f.originalName=u.OriginalName),f.routableLocation=new l(0,0),e=u.DisplayCoordinates||u.RoutableCoordinates||u.Geometry,f.routableLocation.latitude=e.Latitude,f.routableLocation.longitude=e.Longitude,f.displayOrder=u.DisplayOrder,f.labelLocation=f.routableLocation,f.photoUrl=u.Image,f.metadataString=u.Properties&&u.Properties.MetadataString,f.segmentType=u.Properties&&u.Properties.SegmentType,u.DateAccessed&&(f.dateAccessed=u.DateAccessed),u.DateCreated&&(f.dateCreated=u.DateCreated),u.DateModified&&(f.dateModified=u.DateModified),f.categoryId=u.BusinessType,f.AdditionalType=u.AdditionalType,u.Address&&(f.address=u.Address.SingleLine,f.addressFields={formattedAddress:u.Address.SingleLine,city:u.Address.Locality,stateMunicipality:u.Address.Region,country:u.Address.Country,addressLine:u.Address.StreetAddress,postalCode:u.Address.PostalCode,neighborhood:""}),u.EntityIdType){switch(u.EntityIdType.toLowerCase()){case"ypid":f.businesslistingid=i.ypid+":";u.EntityId.toLowerCase().indexOf("yn")===-1&&(f.businesslistingid+="YN");f.businesslistingid+=u.EntityId;break;case"satoriid":f.businesslistingid=i.sid+":";f.businesslistingid+=u.EntityId;break;case"eventid":f.businesslistingid=i.eventId+":";f.businesslistingid+=u.EntityId}f.entityId=u.EntityId;f.entityIdType=u.EntityIdType}else t.hasSatoriId(u.EntityId)?f.businesslistingid=i.sid+":"+u.EntityId:t.hasEventId(u.EntityId)?f.businesslistingid=i.eventId+":"+u.EntityId:t.hasSearchId(u.EntityId)&&(f.businesslistingid=i.ypid+":"+u.EntityId),n.useJsonApiForFavorites&&(f.id=u.EntityId,f.entityId=u.EntityId);return f},r.serialize=function(n){var t,r,u;return n&&(t={},t[i.nameField]=n.name,t[i.id]=n.id,t[i.address]=n.address,t[i.description]=n.description,t[i.displayOrder]=n.displayOrder,t[i.routableLocation]=n.routableLocation,t[i.labelLocation]=n.labelLocation,t[i.photoId]=n.photoId,t.originalName=n.originalName,n.photoUrl&&n.photoUrl!==""&&(r=n.photoUrl,u=n.photoUrl.match("^/th/?"),u&&u.length>-1&&(r=location.protocol+"//"+location.hostname+n.photoUrl),t[i.photoUrl]=r),t[i.businesslistingid]=n.businesslistingid),t},r.serializeCgEntity=function(n,r){var u="Unknown",f,e,o;n.entityId&&n.entityIdType?(u=n.entityIdType,r.EntityId=n.entityId):n.businesslistingid&&(n.businesslistingid.indexOf(i.ypid)!==-1?u="YPID":n.businesslistingid.indexOf(i.sid)!==-1?u="SatoriID":n.businesslistingid.indexOf(i.eventId)!==-1&&(u="EventID"),r.EntityId=n.businesslistingid.replace("ypid:","").replace("sid:","").replace("eventId:",""));r.Name=n.name;r.OriginalName=n.originalName;r.ItemId=n.id;r.Description=n.description;r.EntityIdType=u;r.Address=n.addressFields?{SingleLine:n.address,Locality:n.addressFields.city,Region:n.addressFields.stateMunicipality,Country:n.addressFields.country,PostalCode:n.addressFields.postalCode,StreetAddress:n.addressFields.addressLine}:{SingleLine:n.address};r.DisplayOrder=n.displayOrder;r.BusinessType=n.categoryId;f=t.convertJavascriptDateToDateInTicks(new Date);r.DateCreated=n.dateCreated;r.DateModified=f;r.DateAccessed=f;r.Properties={MetadataString:n.metadataString,SegmentType:n.segmentType};n.photoUrl&&n.photoUrl!==""&&(e=n.photoUrl,o=n.photoUrl.match("^/th/?"),o&&o.length>-1&&(e=location.protocol+"//"+location.hostname+n.photoUrl),r.Image=e)},r.buildEntityDataTaskOptions=function(n){var r={},t={};return t.entryPoint=hi.Collections,t.descriptionList=[],n&&(n.businesslistingid&&(n.businesslistingid.indexOf("ypid:")!==-1||n.businesslistingid.indexOf("sid:")!==-1||n.businesslistingid.indexOf("eventId:")!==-1?t.id=n.businesslistingid:n.businesslistingid!=="0"&&(t.id="ypid:"+n.businesslistingid)),t.query=!t.id&&n.routableLocation?n.routableLocation.latitude.toFixed(i.latLongPrecision)+", "+n.routableLocation.longitude.toFixed(i.latLongPrecision):n.originalName,t.taskTitle=n.name,n.name!==n.originalName&&(t.originalName=n.originalName),n.description&&n.name!==n.description&&t.descriptionList.push(n.description),n.categoryId&&(t.selectedCategoryId=n.categoryId)),r.type=ii.localDetailsTask,r.state=t,r},r.prototype.getTitle=function(){return this.name},r.prototype.getOriginalName=function(){return this.originalName},r.prototype.getDescription=function(){return this.description},r.prototype.getAddress=function(){return this.address},r.prototype.getPhotoUrl=function(){return this.photoUrl},r.localEntityId="",r}(),ri=function(n){function i(t,i,r){var u=n.call(this,t,i,r)||this;return u.entityShown=!0,u}return b(i,n),i.deserializeCgEntity=function(r,u){if(r){var f=r.Name?r.Name:r.OriginalName;return u||(u=new i(r.ItemId||r.EntityId,f,r.Description)),n.deserializeCgEntity.call(this,r,u),u.type=r.$type,r.TimeInformationLocal&&(u.startDate=t.convertDateInTicksToJavascriptDate(r.TimeInformationLocal.StartTime),u.endDate=t.convertDateInTicksToJavascriptDate(r.TimeInformationLocal.EndTime)),r.ReservationDetails&&(u.emailLink=r.ReservationDetails.EmailDeepLinkId,u.reservationId=r.ReservationDetails.BookingConfirmationId),u}return null},i.prototype.getPrimaryLabelText=function(){return this.name},i.prototype.getSecondaryLabelText=function(){return a.L_UpcomingEventEntity_TimeLabelFormat.replace("{date}",g._formatLongDateString(this.startDate)).replace("{time}",g._formatTimeString(this.startDate))},i}(s),ei=function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return b(t,n),t.deserializeCgEntity=function(i){var r,u;return i?(r=new t(i.ItemId||i.EntityId,i.Name,i.Description),n.deserializeCgEntity.call(this,i,r),i.ArrivalAirport&&(i.ArrivalAirport.$type="Airport",r.arrivalAirport=y.deserialize(i.ArrivalAirport,!0),r.arrivalAirport.entity.flight=r,r.arrivalAirport.entity.startDate=r.endDate),i.DepartureAirport&&(i.DepartureAirport.$type="Airport",r.departureAirport=y.deserialize(i.DepartureAirport,!0),r.departureAirport.entity.flight=r,r.name=r.departureAirport.entity.name,r.departureAirport.entity.startDate=r.startDate),i.FlightSegmentEvents&&i.FlightSegmentEvents.length>0&&(u=i.FlightSegmentEvents[0].FlightSegmentInformation,u&&(r.flightNumber=u.FlightNumber,r.airline=u.AirlineName)),r):null},t}(ri),nr=function(n){function t(t,i,r){return n.call(this,t,i,r)||this}return b(t,n),t.deserializeCgEntity=function(i){if(i){var u=i.Name?i.Name:i.OriginalName,r=new t(i.ItemId||i.EntityId,u,i.Description);return n.deserializeCgEntity.call(this,i,r),r.airportCode=i.AirportCode,r.city=i.Address.Locality,r}return null},t.prototype.getSecondaryLabelText=function(){return a.L_UpcomingEventEntity_TimeLabelFormat.replace("{date}",g._formatLongDateString(this.startDate)).replace("{time}",g._formatTimeString(this.startDate))},t}(s),tr=function(){function t(){}return t.deserializeEntity=function(t){var r=null,u,i;if(t&&t.$type){for(u=n.filteredEvents.split(";"),i=0;i<u.length;i++)if(t.$type===u[i])return r;r=t.$type.indexOf("Events")===0?t.$type.indexOf("FlightEvent")!==-1?ei.deserializeCgEntity(t):ri.deserializeCgEntity(t):t.$type.indexOf("Airport")===0?nr.deserializeCgEntity(t):s.deserializeCgEntity(t)}return r},t}(),ir=function(){function n(){this._isValid=!0}return n.prototype.IsValid=function(){return this._isValid},n.prototype.Delete=function(){return},n}(),p;(function(n){n[n.AddItem=1]="AddItem";n[n.DeleteItem=2]="DeleteItem";n[n.MetaUpdate=3]="MetaUpdate";n[n.ItineraryUpdate=4]="ItineraryUpdate"})(p||(p={}));var rt=function(n){function t(t){var i=n.call(this)||this;return i._privates.defineProperty("days",function(n,t){i.setDayCount(t.length)}),i._privates.defineProperty("cityName"),i._privates.defineProperty("image"),i._privates.defineProperty("guideUrl"),i._privates.defineProperty("interestTypes"),i._privates.defineProperty("attribution"),i._privates.defineProperty("itineraryId"),i._privates.defineProperty("gettyID"),i._privates.defineProperty("photographer"),i._privates.defineProperty("name",function(n,t){i._metaChangedHandler(n,t)}),i._privates.defineProperty("description",function(n,t){i._metaChangedHandler(n,t)}),i._privates.defineProperty("dayCount",function(n,t){i._updateAttractionCount();i._dayCountChangedHandler(n,t)}),i._privates.defineProperty("attractionCount"),i._privates.defineProperty("destinations",function(n,t){i._destinationsChangedHandler(n,t)}),i._privates.defineProperty("startDate",function(n,t){i._travelDatesChangedHandler(n,t)}),i._privates.defineProperty("endDate",function(n,t){i._travelDatesChangedHandler(n,t)}),i._dataManager=new vt,i.disposables=[],i._updateQueue=[],i.errorEvent=new k,i.itemsRetrieved=!1,i.isActive=!1,i.activeDay=0,i.HighlightsText=t.ItineraryExtraInfo&&t.ItineraryExtraInfo.Highlights?t.ItineraryExtraInfo.Highlights:null,i.version=t.Version,i.satoriId=t.SatoriId,t&&(i.deserializeItineraryProperties(t),i._initialized=!0),i.collageImages=t.CollageImages?t.CollageImages:new c,i.itineraryAttractions=t.ItineraryAttractions?t.ItineraryAttractions:new c,i}return b(t,n),t.prototype.dispose=function(){n.prototype.dispose.call(this);g._clearDisposables(this.disposables)},t.deserialize=function(n){return new t(n)},t.serialize=function(n){var t={CityName:n.getCityName(),GuideUrl:n.getGuideUrl(),InterestTypes:n.getInterestTypes(),Attribution:n.getAttribution(),ItineraryId:n.getItineraryId(),SeeAllPoisUrl:n.seeAllPoisUrl,CollectionId:n.collectionId,Name:n.getName(),Description:n.getDescription(),Image:{Url:n.getImage()},ETag:n.eTag,ItineraryMetaETag:n.itineraryMetaETag,Days:[],gettyID:n.getGettyID(),photographer:n.getPhotographer(),startDate:n.getStartDate(),endDate:n.getEndDate(),Version:n.version,SatoriId:n.satoriId},r,o,u,h,f,i,s,e;for(n.HighlightsText&&(t.ItineraryExtraInfo={Highlights:n.HighlightsText,StateName:null,ImageUrls:null}),n.collageImages&&(t.CollageImages=n.collageImages),n.itineraryAttractions&&(t.ItineraryAttractions=n.itineraryAttractions),r=n.getDays(),o=0,u=0,h=r.length;u<h;u++){var c=r[u],l=c.length,a=[];for(f=0;f<l;f++)a.push(c[f].getItineraryItemMeta());t.Days.push(a);o+=l}if(t.DayCount=r.length,t.AttractionCount=o,i=n.getDestinations(),i&&i.length){for(s=[],e=0;e<i.length;e++)s.push(i[e].getItineraryItemMeta());t.Destinations=s}return t},t.prototype.deserializeItineraryProperties=function(n){var p=this,v,s,f,y,t,h,u,e,i,l;this.setCityName(n.CityName);this.setImage(n.Image&&n.Image.Url);this.setGuideUrl(n.GuideUrl);this.setInterestTypes(n.InterestTypes);this.setAttribution(n.Attribution);this.setItineraryId(n.ItineraryId);this.setName(n.Name);this.setDescription(n.Description||"");this.setGettyID(n.gettyID);this.setPhotographer(n.photographer);n.startDate&&this.setStartDate(n.startDate);n.endDate&&this.setEndDate(n.endDate);this.seeAllPoisUrl=n.SeeAllPoisUrl;this.collectionId=n.CollectionId;this.eTag=n.ETag;this.itineraryMetaETag=n.ItineraryMetaETag;var r=n.Days,o=[],a=0;if(this.HighlightsText=n.ItineraryExtraInfo&&n.ItineraryExtraInfo.Highlights?n.ItineraryExtraInfo.Highlights:null,this.version=n.Version,this.satoriId=n.SatoriId,n.CollageImages&&(this.collageImages=n.CollageImages),n.ItineraryAttractions&&(this.itineraryAttractions=n.ItineraryAttractions),!this.itemsRetrieved&&n.Destinations){for(v=new c,s=0;s<n.Destinations.length;s++)v.insert(new dt(n.Destinations[s],-1,0));this.setDestinations(v)}else this.itemsRetrieved||this.setDestinations(new c);if(r)if(f=this.getDays(),this.itemsRetrieved&&f&&f.length&&f.length===r.length&&this.getAttractionCount()===n.AttractionCount)for(t=0,h=r.length;t<h;t++)for(y=f[t],u=r[t],i=0,l=u.length;i<l;i++)y[i].cloudGraphId=u[i].CloudGraphId;else{for(t=0,h=r.length;t<h;t++){for(u=r[t],e=new c,i=0,l=u.length;i<l;i++)e.insert(new dt(u[i],t,i,this.collectionId));this.disposables.push(e.changed.add(function(n){return p._dayChangedHandler(n)}));o.push(e);a+=e.length}o.length&&n.AttractionCount===a&&(this.itemsRetrieved=!0);this.setDays(o);this.setDayCount(n.DayCount||o.length);this.setAttractionCount(n.AttractionCount||a)}},t.prototype.copy=function(n){var i=t.serialize(this);return n&&(i.Days=[]),new t(i)},t.prototype.addDay=function(){var i=this,n=new c,t;return this.disposables.push(n.changed.add(function(n){return i._dayChangedHandler(n)})),t=this.getDays(),t.push(n),this.setDayCount(t.length),n},t.prototype.removeDay=function(n){var r=this.getDays(),t,i,f,u;if(n>=0&&n<r.length){for(t=r.splice(n,1)[0],this.setDayCount(r.length),i=0,f=t.length;i<f;i++)u=t[i],this._removeMetadataForEntity(!0,u),this._removeMetadataForEntity(!1,u);return t}return null},t.prototype.startReorder=function(){this._isReordering=!0},t.prototype.endReorder=function(){if(this.collectionId&&this._initialized){this._isReordering=!1;var n={UpdateType:p.ItineraryUpdate};this._updateQueue.push(n);this._requestOut||this._checkUpdateQueue()}},t.prototype.routeInfoUpdated=function(){if(this.collectionId&&this._initialized){var n={UpdateType:p.ItineraryUpdate};this._updateQueue.push(n);this._requestOut||this._checkUpdateQueue()}},t.prototype._checkUpdateQueue=function(){if(this._updateQueue.length>0){var n=this._updateQueue.splice(0,1)[0];switch(n.UpdateType){case p.AddItem:this._makeAddCall(n.ChangeEvent);break;case p.DeleteItem:this._makeDeleteCall(n.ChangeEvent);break;case p.MetaUpdate:this._makeUpdateMetaDataCall();break;case p.ItineraryUpdate:this._makeUpdateItineraryCall()}}},t.prototype._metaChangedHandler=function(n,t){if(t!==n&&this.collectionId&&this._initialized){var i={UpdateType:p.MetaUpdate};this._updateQueue.push(i);this._requestOut||this._checkUpdateQueue()}},t.prototype._travelDatesChangedHandler=function(n,t){if(t!==n&&this.collectionId&&this._initialized){var i={UpdateType:p.MetaUpdate};this._updateQueue.push(i);this._requestOut||this._checkUpdateQueue()}},t.prototype._destinationsChangedHandler=function(n,t){if(t&&t.length!==0&&this.collectionId&&this._initialized){var i={UpdateType:p.MetaUpdate};this._updateQueue.push(i);this._requestOut||this._checkUpdateQueue()}},t.prototype._dayCountChangedHandler=function(n,t){var i=t>n?p.MetaUpdate:t<n?p.ItineraryUpdate:null,r;i&&this.collectionId&&this._initialized&&(r={UpdateType:i},this._updateQueue.push(r),this._requestOut||this._checkUpdateQueue())},t.prototype._dayChangedHandler=function(n){var t=n.added&&n.added.length?p.AddItem:n.removed&&n.removed.length?p.DeleteItem:null,i,r;if(!t||!this.collectionId||!this._initialized||this._isReordering){t&&!this.collectionId&&this._initialized&&!this._isReordering&&(i=this.getAttractionCount()+(t===p.AddItem?1:-1),this.setAttractionCount(i));return}r={UpdateType:t,ChangeEvent:n};this._updateQueue.push(r);this._requestOut||this._checkUpdateQueue()},t.prototype._makeUpdateMetaDataCall=function(){var n=this;this._requestOut=!0;this._dataManager.updateItineraryMeta(this,function(t,i){n._requestOut=!1;i===0?n._checkUpdateQueue():n.errorEvent.invoke(i)})},t.prototype._makeUpdateItineraryCall=function(){for(var r,t,f,e,i=this,u=this.getDays(),n=0,o=u.length;n<o;n++)for(r=u[n],t=0,f=r.length;t<f;t++)e=r[t],e.dayIndex=n;this._requestOut=!0;this._dataManager.updateItinerary(this,function(n,t){i._requestOut=!1;t===0?i._checkUpdateQueue():i.errorEvent.invoke(t)})},t.prototype._makeAddCall=function(n){var t=this,i=n.added[0];this._requestOut=!0;this._dataManager.addItineraryItem(this.collectionId,i,function(r,u){if(t._requestOut=!1,u===0){t._updateItineraryMetaWithNewImageAndInformation(!0,i);t._updateItineraryMetaWithNewImageAndInformation(!1,i);var f={UpdateType:p.MetaUpdate};t._updateQueue.push(f);t.setAttractionCount(t.getAttractionCount()+n.added.length);t._checkUpdateQueue()}else t.errorEvent.invoke(u)})},t.prototype._makeDeleteCall=function(n){var t=this,i=n.removed[0];this._requestOut=!0;this._dataManager.deleteItineraryItem(this.collectionId,i.cloudGraphId,function(r){if(t._requestOut=!1,r===0){t.setAttractionCount(t.getAttractionCount()-n.removed.length);t._removeMetadataForEntity(!0,i);t._removeMetadataForEntity(!1,i);var u={UpdateType:p.MetaUpdate};t._updateQueue.push(u);t._checkUpdateQueue()}else t.errorEvent.invoke(r)})},t.prototype._updateAttractionCount=function(){for(var t=this.getDays(),i=0,n=0,r=t.length;n<r;n++)i+=t[n].length;this.setAttractionCount(i)},t.prototype._removeMetadataForEntity=function(n,t){var r=n?this.collageImages:this.itineraryAttractions,h,c,o,u,s,f,i,e;if(r.remove(n?t.imageUrl:t.getOriginalName()),h=this.getAttractionCount(),c=this.getDays(),r.length<3&&h>=3)for(o=!1,u=0,s=c;u<s.length;u++){for(f=s[u],i=0;i<f.length;i++)if(e=n?f[i].imageUrl:f[i].getOriginalName(),e&&r.indexOf(e)===-1){r.insert(e);o=!0;break}if(o)break}},t.prototype._updateItineraryMetaWithNewImageAndInformation=function(n,t){var i=n?t.imageUrl:t.getOriginalName(),u=n?this.collageImages.length:this.getAttractionCount(),r;i&&u<3&&(r=n?this.collageImages:this.itineraryAttractions,r.insert(i,0))},t}(it),oi=function(){function n(n,t,i){this.Rating=n;this.TotalNo=t;this.Provider=i;this.processStars()}return n.prototype.processStars=function(){for(var t,n=0;n<5;n++)t=ct.noStar,t=this.Rating>n?this.Rating>n+.5?ct.fullStar:ct.halfStar:ct.noStar,n===0?this.Star1=[t,this.Provider]:n===1?this.Star2=[t,this.Provider]:n===2?this.Star3=[t,this.Provider]:n===3?this.Star4=[t,this.Provider]:n===4&&(this.Star5=[t,this.Provider])},n}(),rr=function(){function n(n,t,i){this.timeIn24Hours=n;this.timeIn12Hours=t;this.selected=i}return n}(),ct;(function(n){n[n.fullStar=3]="fullStar";n[n.halfStar=2]="halfStar";n[n.noStar=1]="noStar"})(ct||(ct={}));var dt=function(n){function i(t,r,u,f,e,o){var s=this,h={},a,p,v,y,c;return s=n.call(this,h)||this,a=et.features,p=a&&a.directions&&a.directions.unit,s._useKm=p===2,s.openHoursData=t.OpenHoursData,h.defineProperty("name",function(n,t){return s._updateItineraryItem(n,t)},null,{defaultValue:t.Name||t.OriginalName}),h.defineProperty("originalName",null,null,{defaultValue:t.OriginalName||t.Name}),h.defineProperty("description",function(n,t){return s._updateItineraryItem(n,t)},null,{defaultValue:t.Description||""}),h.defineProperty("interestTypes",null,null,{defaultValue:t.InterestTypes}),h.defineProperty("stayDuration",null,null,{defaultValue:t.StayDuration||t.StayDurationInMinutes&&g._formatDurationString(t.StayDurationInMinutes*60)||g._formatDurationString(5400)}),h.defineProperty("modeToNext",function(){s._updatePrimitiveModeToNext()},null,{defaultValue:t.ModeToNext}),h.defineProperty("itemIndex",function(){s._updatePrimitiveIndex()},null,{defaultValue:u}),h.defineProperty("timeToNext",function(){s._updateDirectionsText()},null,{defaultValue:t.TimeToNext}),h.defineProperty("kmToNext",function(){s._updateDirectionsText()},null,{defaultValue:t.KmToNext}),h.defineProperty("directionsText"),h.defineProperty("startTime",null,null,{defaultValue:"10:00"}),h.defineProperty("isStartTimeSelected"),h.defineProperty("isValidStartTime"),h.defineProperty("timeOptions"),h.defineProperty("address"),h.defineProperty("phoneNo"),h.defineProperty("category"),h.defineProperty("openHour"),h.defineProperty("actionName"),h.defineProperty("actionUrl"),h.defineProperty("priceInfo"),h.defineProperty("stayDurationInMinutes"),s._dataManager=new vt,s._updateDirectionsText(),s.errorEvent=new k,v=t.Image&&t.Image.Url,v=s._formatImageUrl(v),s.imageUrl=v,s.cloudGraphId=t.CloudGraphId||"",s._collectionId=f||"",s.setStayDurationInMinutes(t.StayDurationInMinutes),s.dayIndex=r,s.categoryId=t.CategoryId,s.entityTypes=t.EntityTypes,s.destination=t.Destination,s.openingTime=t.OpeningTime,t.Rating&&(s.rating=new oi(t.Rating.Rating,t.Rating.TotalNo,t.Rating.Provider)),s.setCategory(t.InterestTypes?t.InterestTypes[0]:null),s.setAddress(t.Address),s.setPhoneNo(t.PhoneNo),s.setOpenHour(i._formatOpenHoursData(t.OpenHoursData)),s.setActionName(t.ActionName),s.setActionUrl(t.ActionUrl),t.StartTime&&s.setStartTime(t.StartTime),s.setTimeOptions(s.createTimeOptions()),s.setStayDurationInMinutes(t.StayDurationInMinutes?t.StayDurationInMinutes:90),s.setStayDuration(s.getStayDuration()?s.getStayDuration():g._formatDurationString(5400)),s.setPriceInfo(t.PriceInfo),s.setIsValidStartTime(i.isValidStartTime(t.StartTime,o,r,t.OpenHoursData)),s.setIsStartTimeSelected(t.IsStartTimeSelected),t.Lat&&t.Lon&&(y=new l(t.Lat,t.Lon),c=new yi(t.Name,"",t.Id,y),c.modeToNext=t.ModeToNext,c.dayIndex=r,c.itemIndex=s.getItemIndex(),c.iconText=(s.getItemIndex()+1).toString(),c.isActiveDay=e,c.originalName=s.getOriginalName(),c.imageUrl=s.imageUrl,(!c.getPrimaryCategoryPath||c.getPrimaryCategoryPath().length===0&&t.CategoryId&&t.CategoryId.length>0)&&c.setPrimaryCategoryPath(t.CategoryId),s._primitive=new vi(y,c)),s}return b(i,n),i.getItemFromLocalSearchEntity=function(n){var f=n.getImageUrl()||"",u=f.match("/th/??"),r,t;return u&&u.length>-1&&n.setImageUrl(f.substr(u.index)),r={Name:n.getTitle(),Id:n.id,Lat:n.getLocation().latitude,Lon:n.getLocation().longitude,Image:{Url:n.getImageUrl()},CategoryId:n.getSelectedCategoryForIcon()},t=n.addressFields,r.Destination=t&&(t.city||t.stateMunicipality||t.country),r.EntityTypes=n.getSegmentTypes(),new i(r,-1,0)},i.prototype.setIsActive=function(n){this._primitive&&this._primitive.entity&&(this._primitive.entity.isActiveDay=n)},i.prototype.updatePrimitiveHTMLElement=function(n){this._primitive&&this._primitive.entity&&(this._primitive.entity.htmlElement=n)},i.prototype.getPrimitive=function(){return this._primitive},i.prototype.getPrimitiveLocation=function(){var n=this._primitive&&this._primitive.entity&&this._primitive.entity;return n&&n.getLocation()},i.prototype.getId=function(){var n=this._primitive&&this._primitive.entity&&this._primitive.entity;return n&&n.id},i.prototype.dispose=function(){n.prototype.dispose.call(this);this._primitive.dispose();this._primitive=null},i.prototype.getItineraryItemMeta=function(){var i=this._primitive&&this._primitive.entity&&this._primitive.entity,t,n;return i?(t={Url:this.imageUrl},n={Name:this.getName(),OriginalName:this.getOriginalName(),Description:this.getDescription(),Id:this._primitive.entity.id,Lat:this._primitive.getLocation().latitude,Lon:this._primitive.getLocation().longitude,StayDuration:this.getStayDuration(),StayDurationInMinutes:this.getStayDurationInMinutes(),Image:t,InterestTypes:this.getInterestTypes()||(this.getCategory()?[this.getCategory()]:null),TimeToNext:this.getTimeToNext(),KmToNext:this.getKmToNext(),ModeToNext:this.getModeToNext(),CloudGraphId:this.cloudGraphId,DayIndex:this.dayIndex,ItemIndex:this.getItemIndex(),CategoryId:this.categoryId,EntityTypes:this.entityTypes,Destination:this.destination,OpeningTime:this.openingTime,StartTime:this.getStartTime(),Address:this.getAddress(),PhoneNo:this.getPhoneNo(),OpenHour:this.getOpenHour(),OpenHoursData:this.openHoursData,ActionName:this.getActionName(),ActionUrl:this.getActionUrl(),PriceInfo:this.getPriceInfo(),IsValidStartTime:this.getIsValidStartTime(),IsStartTimeSelected:this.getIsStartTimeSelected()},this.rating&&(n.Rating={Rating:this.rating.Rating,TotalNo:this.rating.TotalNo,Provider:this.rating.Provider}),n):null},i.prototype.setItineraryItemMeta=function(n){n.Name&&this.setName(n.Name);n.OriginalName&&this.setOriginalName(n.OriginalName);n.Description&&this.setDescription(n.Description);n.StayDuration&&this.setStayDuration(n.StayDuration);n.StayDurationInMinutes&&this.setStayDurationInMinutes(n.StayDurationInMinutes);this.imageUrl=n.Image?n.Image.Url:null;n.InterestTypes&&this.setInterestTypes(n.InterestTypes);n.InterestTypes&&this.setCategory(n.InterestTypes[0]);n.TimeToNext&&this.setTimeToNext(n.TimeToNext);n.KmToNext&&this.setKmToNext(n.KmToNext);n.ModeToNext&&this.setModeToNext(n.ModeToNext);n.CloudGraphId&&(this.cloudGraphId=n.CloudGraphId);n.DayIndex&&(this.dayIndex=n.DayIndex);n.ItemIndex&&this.setItemIndex(n.ItemIndex);n.CategoryId&&(this.categoryId=n.CategoryId);n.EntityTypes&&(this.entityTypes=n.EntityTypes);n.Destination&&(this.destination=n.Destination);n.OpeningTime&&(this.openingTime=n.OpeningTime);n.StartTime&&this.setStartTime(n.StartTime);this.rating=n.Rating?new oi(n.Rating.Rating,n.Rating.TotalNo,n.Rating.Provider):null;n.Address&&this.setAddress(n.Address);n.PhoneNo&&this.setPhoneNo(n.PhoneNo);n.OpenHoursData&&this.setOpenHour(i._formatOpenHoursData(n.OpenHoursData));n.OpenHoursData&&(this.openHoursData=n.OpenHoursData);n.ActionName&&this.setActionName(n.ActionName);n.ActionUrl&&this.setActionUrl(n.ActionUrl);n.PriceInfo&&this.setPriceInfo(n.PriceInfo);this.setIsValidStartTime(n.IsValidStartTime);this.setIsStartTimeSelected(n.IsStartTimeSelected)},i.prototype.setCollectionId=function(n){this._collectionId=n},i.prototype._updateDirectionsText=function(){var n=g._formatDurationString(this.getTimeToNext())+" · "+g._readableTextFromDistance(this.getKmToNext()*1e3,this._useKm);this.setDirectionsText(n)},i.prototype._updatePrimitiveIndex=function(){if(this._primitive&&this._primitive.entity){var n=this._primitive.entity;n.itemIndex=this.getItemIndex();n.iconText=(this.getItemIndex()+1).toString()}},i.prototype._updatePrimitiveModeToNext=function(){if(this._primitive&&this._primitive.entity){var n=this._primitive.entity;n.modeToNext=this.getModeToNext()}},i.prototype._updateItineraryItem=function(n,t,i){var r=this;(t!==n||i)&&this._collectionId&&(this._updateRequestOut?this._updateAgain=!0:(this._updateAgain=!1,this._updateRequestOut=!0,this._dataManager.updateItineraryItem(this._collectionId,this,function(n){n===0?(r._updateRequestOut=!1,r._updateAgain&&r._updateItineraryItem("","",!0)):r.errorEvent.invoke(n)})))},i.prototype._formatImageUrl=function(n){var i,r,t,u,f;return n&&(i=n.indexOf("&h="),r=n.indexOf("&w="),i>0&&r>0?(t=n.indexOf("&",i+3),t===-1&&(t=n.length),u=n.substring(i,t),n=n.replace(u,"&h=120"),t=n.indexOf("&",r+3),t===-1&&(t=n.length),f=n.substring(r,t),n=n.replace(f,"&w=120")):(n+="&h=120&w=120",n.indexOf("&c=")===-1&&(n+="&c=7"))),n},i._formatOpenHoursData=function(n){var r;if(!n||n.length===0)return null;var e="",s="",t=n[0];if(t.ClosedDays&&t.ClosedDays.length>0){for(r=0;r<t.ClosedDays.length;r++)s+=t.ClosedDays[r],r<t.ClosedDays.length-1&&(s+=", ");s+=": "+pi.Closed}if(t.Hours&&t.Hours.length>0){var h="",f=0,c=0,o="",u="";for(r=0;r<t.Hours.length;r++)o=i._getHoursRangeString(t.Hours[r].HoursRanges),o===h||h===""?(f===0&&(u=t.Hours[r].Day),f++):f===0?(c++,u=t.Hours[r].Day+": "+o,r<t.Hours.length-1&&(u+=", "),e+=u):(c+=f,f=1,u+=" - "+t.Hours[r-1].Day+": "+h,r<t.Hours.length-1&&(u+=", "),e+=u,u=t.Hours[r].Day),h=o;f>1&&c+f===t.Hours.length&&u!==""&&o!==""?e+=u+" - "+t.Hours[t.Hours.length-1].Day+": "+o:f===1&&c+f===t.Hours.length&&u!==""&&o!==""&&(e+=", "+u+": "+o)}return s.length>0&&(e.length>0?e+=", "+s:e=s),e},i._getHoursRangeString=function(n){var t="",r,u;if(!n||n.length===0)return t;for(r=0;r<n.length;r++)u=n[r],u.Start&&u.End&&(t+=i._getHourString(u.Start),t+=" - ",t+=i._getHourString(u.End)),r<n.length-1&&(t+=", ");return t},i._getHourString=function(n){var t="",i=!1;return n.Hour===0||n.Hour===24?t="12":n.Hour>=12?(i=!0,t=n.Hour>12?(n.Hour-12).toString():n.Hour.toString()):t=n.Hour.toString(),n.Minute>0&&(t+=":"+n.Minute),t+(i?" PM":" AM")},i.prototype.createTimeOptions=function(n){var i=new c,t;for(n||(n=this.getStartTime());n&&n!=="23:30:00"&&n!=="24:00:00";)t=this.computeStartTime(n,30),i.insert(new rr(t[0],t[1],!1)),n=t[0];return i},i.prototype.computeStartTime=function(n,i,r){var u=[];return u.push(t.computeStartTime(n,i,r)),u.push(t.createStartTimeInAPM(n,i,r)),u},i.isValidStartTime=function(n,i,r,u){var v,h,e,c,y,p,l,s,f;if(r===void 0&&(r=0),!u||u.length===0)return!0;if(v=["sun","mon","tue","wed","thu","fri","sat"],h=new Date,i&&(h=new Date(i)),e=new Date(h.getTime()),e.setDate(e.getDate()+r),c=v[e.getDay()],y=e.getMonth()+1+"-"+e.getDate(),u[0].ClosedDays&&u[0].ClosedDays.length>0&&(p=u[0].ClosedDays&&u[0].ClosedDays.filter(function(n){return n.replace("/","-").toLowerCase()===y||n.toLowerCase()===c?!0:!1}),p.length>0))return!1;if(l=u[0].Hours.filter(function(n){return n.Day.toLowerCase()===c}),l.length===0)return!0;var o=!1,w=t.computeTimeInMinutes(n),a=l[0];if(a.IsClosed)o=!1;else for(s=0;s<a.HoursRanges.length;s++)if(f=a.HoursRanges[s],f.End.Hour=f.Start.Hour*60+f.Start.Minute>=f.End.Hour*60+f.End.Minute?f.End.Hour+24:f.End.Hour,o=o||w>=f.Start.Hour*60+f.Start.Minute&&w<f.End.Hour*60+f.End.Minute,o)break;return o},i}(it),lt=function(n){function r(){var t=n.call(this)||this;return t.geometryType=3,t.crs=wt.instance,t}return b(r,n),r.prototype.getGeometry=function(){return this.geometry},r.prototype.setGeometry=function(n){this.geometry=n;this._length=t.calculateLength(this.geometry);this._area=t.calculateArea(this.geometry)},r.prototype.getArea=function(){return this._area||(this._area=t.calculateArea(this.geometry)),this._area},r.prototype.getLength=function(){return this._length||(this._length=t.calculateLength(this.geometry)),this._length},r.prototype.getLengthText=function(){var n=et.features,t=n&&n.directions&&n.directions.unit;return g._createLengthText(this.getLength(),t===2)},r.prototype.getAreaText=function(){var n=et.features,t=n&&n.directions&&n.directions.unit;return g._createAreaText(this.getArea(),t===2)},r.deserialize=function(n,t){if(t)return r.deserializeCgPolygon(n);var i;return n&&(i=new r,i.setGeometry(n.geometry),i.entity=s.deserialize(n.entity),i.polyShapeStyle=n.style,i.template=new pt(n.style),i.entity.routableLocation.latitude&&i.entity.routableLocation.longitude||(i.entity.routableLocation.latitude=i.geometry.rings[0].y[0],i.entity.routableLocation.longitude=i.geometry.rings[0].x[0])),i},r.deserializeCgPolygon=function(n){var o,h,u,f,e,c,l,a;if(n&&n.Geometry){for(h=n.Geometry,u=h.OuterBoundary,o=new r,f={rings:[{x:[u[0].Longitude],y:[u[0].Latitude]}],bounds:[u[0].Latitude,u[0].Longitude,u[0].Latitude,u[0].Longitude]},e=1;e<u.length;e++)c=u[e].Latitude,l=u[e].Longitude,f.rings[0].x[e]=l,f.rings[0].y[e]=c,c>f.bounds[0]?f.bounds[0]=c:c<f.bounds[2]&&(f.bounds[2]=c),l>f.bounds[1]?f.bounds[1]=l:l<f.bounds[3]&&(f.bounds[3]=l);if(u=h.InnerBoundary,u&&u.length)for(f.rings[1]={x:[],y:[]},e=0;e<u.length;e++)c=u[e].Latitude,l=u[e].Longitude,f.rings[1].x[e]=l,f.rings[1].y[e]=c;o.setGeometry(f);o.entity=s.deserializeCgEntity(n);h.Style?(a=t.convertStrokeWeightToLineWidth(h.Style.StrokeWeight),o.polyShapeStyle={fillStyle:h.Style.FillColor,strokeStyle:h.Style.StrokeColor,lineWidth:a,strokeWidth:a,dashes:t.convertStrokeDashStyleToDashes(h.Style.StrokeDashStyle)}):o.polyShapeStyle=i.defaultStyle;o.template=new pt(o.polyShapeStyle)}return o},r.serialize=function(n,t){if(t)return r.serializeCgPolygon(n);var u;return n&&(u={},u[i.geometryType]=n.geometryType,u[i.geometry]=n.getGeometry(),u[i.entity]=s.serialize(n.entity),u[i.style]=n.polyShapeStyle),u},r.serializeCgPolygon=function(n){var u,f,r,i;if(n){for(f=n.entity,r={$type:"GeometryPolygon",OuterBoundary:[],InnerBoundary:[],Style:{FillColor:n.polyShapeStyle.fillStyle,StrokeColor:n.polyShapeStyle.strokeStyle,StrokeWeight:t.convertLineWidthToStrokeWeight(n.polyShapeStyle.lineWidth),StrokeDashStyle:t.convertDashesToStrokeDashStyle(n.polyShapeStyle.dashes)}},i=0;i<n.geometry.rings[0].x.length;i++)r.OuterBoundary[i]={Latitude:n.geometry.rings[0].y[i],Longitude:n.geometry.rings[0].x[i]};if(n.geometry.rings[1])for(i=0;i<n.geometry.rings[1].x.length;i++)r.InnerBoundary[i]={Latitude:n.geometry.rings[1].y[i],Longitude:n.geometry.rings[1].x[i]};u={$type:"GeoAnnotation",Geometry:r,RoutableCoordinates:r.OuterBoundary[0],DisplayCoordinates:r.OuterBoundary[0],ShowOnMap:!0};s.serializeCgEntity(f,u)}return u},r.prototype.isTapEnabled=function(){return!0},r}(it),at=function(n){function r(){var t=n.call(this)||this;return t.geometryType=2,t.crs=wt.instance,t}return b(r,n),r.prototype.getGeometry=function(){return this.geometry},r.prototype.setGeometry=function(n){this.geometry=n;this._length=t.calculateLength(this.geometry)},r.prototype.getArea=function(){return 0},r.prototype.getLength=function(){return this._length||(this._length=t.calculateLength(this.geometry)),this._length},r.prototype.getLengthText=function(){var n=et.features,t=n&&n.directions&&n.directions.unit;return g._createLengthText(this.getLength(),t===2)},r.deserialize=function(n,t){if(t)return r.deserializeCgPolyline(n);var i;return n&&(i=new r,i.setGeometry(n.geometry),i.entity=s.deserialize(n.entity),i.polyShapeStyle=n.style,i.template=new pt(n.style),i.entity.routableLocation.latitude&&i.entity.routableLocation.longitude||(i.entity.routableLocation.latitude=i.geometry.y[0],i.entity.routableLocation.longitude=i.geometry.x[0])),i},r.deserializeCgPolyline=function(n){var e,o,f,u,h,c,l,a;if(n&&n.Geometry){for(o=n.Geometry,f=o.Points,e=new r,u={x:[f[0].Longitude],y:[f[0].Latitude],bounds:[f[0].Latitude,f[0].Longitude,f[0].Latitude,f[0].Longitude]},h=1;h<f.length;h++)c=f[h].Latitude,l=f[h].Longitude,u.x[h]=l,u.y[h]=c,c>u.bounds[0]?u.bounds[0]=c:c<u.bounds[2]&&(u.bounds[2]=c),l>u.bounds[1]?u.bounds[1]=l:l<u.bounds[3]&&(u.bounds[3]=l);e.setGeometry(u);e.entity=s.deserializeCgEntity(n);o.LineStyle?(a=t.convertStrokeWeightToLineWidth(o.LineStyle.StrokeWeight),e.polyShapeStyle={fillStyle:o.LineStyle.FillColor,strokeStyle:o.LineStyle.StrokeColor,strokeWidth:a,lineWidth:a,dashes:t.convertStrokeDashStyleToDashes(o.LineStyle.StrokeDashStyle)}):e.polyShapeStyle=i.defaultStyle;e.template=new pt(e.polyShapeStyle)}return e},r.serialize=function(n,t){if(t)return r.serializeCgPolyline(n);var u;return n&&(u={},u[i.geometryType]=n.geometryType,u[i.geometry]=n.getGeometry(),u[i.entity]=s.serialize(n.entity),u[i.style]=n.polyShapeStyle),u},r.serializeCgPolyline=function(n){var u,f,r,i;if(n){for(f=n.entity,r={$type:"GeometryLine",Points:[],LineStyle:{FillColor:n.polyShapeStyle.fillStyle,StrokeColor:n.polyShapeStyle.strokeStyle,StrokeWeight:t.convertLineWidthToStrokeWeight(n.polyShapeStyle.lineWidth),StrokeDashStyle:t.convertDashesToStrokeDashStyle(n.polyShapeStyle.dashes)}},i=0;i<n.geometry.x.length;i++)r.Points[i]={Latitude:n.geometry.y[i],Longitude:n.geometry.x[i]};u={$type:"GeoAnnotation",Geometry:r,RoutableCoordinates:r.Points[0],DisplayCoordinates:r.Points[0],ShowOnMap:!0};s.serializeCgEntity(f,u)}return u},r.prototype.isTapEnabled=function(){return!0},r}(it),y=function(n){function t(){var t=n.call(this)||this;return t.geometryType=1,t.crs=wt.instance,t}return b(t,n),t.simplePointFactory=function(n){var o=n.location,f=o?+o.latitude.toFixed(6):0,e=o?+o.longitude.toFixed(6):0,c=n.title?n.title:f+", "+e,y=n.description?n.description:"",a=n.photoUrl?n.photoUrl:"",r=new s(s.localEntityId,c,y),u,h;if(r.address=n.address,n.addressFields&&(r.addressFields=n.addressFields),r.metadataString=n.metadataString,r.segmentType=n.segmentType,a!==""&&(r.photoUrl=a),r.routableLocation=r.labelLocation=new l(f,e),r.displayOrder=1,r.categoryId=n.categoryId,u=n.id,u&&u.length<=50){var v=u.toLowerCase().indexOf(i.ypid)===0,p=u.toLowerCase().indexOf(i.sid)===0,w=u.toLowerCase().indexOf(i.eventId.toLowerCase())===0;v&&u.toLowerCase().indexOf("yn")===-1&&(u=u.replace(":",":YN"));(v||p||w)&&(r.businesslistingid=u)}return n.nickName&&(r.originalName=c,r.name=n.nickName),h=new t,h.setGeometry({x:e,y:f,bounds:[f,e,f,e]}),h.entity=r,h},t.createSimplePointFromSearchEntity=function(n){var h=n.getTitle(),c=n.getAddress(),a=n.getDescription(),v=n.id&&n.id.length<=50&&(n.id.toLowerCase().indexOf(i.ypid)===0||n.id.toLowerCase().indexOf(i.sid)===0)?n.id:null,u=n.getLocation(),f=u?u.latitude:0,e=u?u.longitude:0,r=new s(s.localEntityId,h,a),o;return r.address=c,r.routableLocation=r.labelLocation=new l(f,e),r.displayOrder=1,r.businesslistingid=v,o=new t,o.setGeometry({x:e,y:f,bounds:[f,e,f,e]}),o.entity=r,o},t.prototype.getGeometry=function(){return this.geometry},t.prototype.setGeometry=function(n){this.geometry=n},t.prototype.getArea=function(){return 0},t.prototype.getLength=function(){return 0},t.deserialize=function(n,i){var r,u;return i?t.deserializeCgPoint(n):(n&&(r=new t,r.setGeometry(n.geometry),r.entity=s.deserialize(n.entity),r.entity.routableLocation.latitude&&r.entity.routableLocation.longitude&&(r.entity.routableLocation.latitude!==0||r.entity.routableLocation.longitude!==0)||(r.entity.routableLocation.latitude=r.geometry.y,r.entity.routableLocation.longitude=r.geometry.x),u=r.entity),r)},t.deserializeCgPoint=function(n){var r,i,u;if(n)if(i=n.Geometry||n.DisplayCoordinates||n.RoutableCoordinates,r=new t,r.setGeometry({x:i.Longitude,y:i.Latitude,bounds:[i.Latitude,i.Longitude,i.Latitude,i.Longitude]}),u=tr.deserializeEntity(n),u)r.entity=u;else return null;return r},t.serialize=function(n,r){if(r)return t.serializeCgPoint(n);var u;return n&&(u={},u[i.geometryType]=n.geometryType,u[i.geometry]=n.getGeometry(),u[i.entity]=s.serialize(n.entity)),u},t.serializeCgPoint=function(n){var i,r,t;return n&&(r=n.entity,t={$type:"GeometryPoint",Latitude:n.geometry.y,Longitude:n.geometry.x},i={$type:"Place",RoutableCoordinates:t,DisplayCoordinates:t,Geometry:t,ShowOnMap:!0,AdditionalType:n.AdditionalType},s.serializeCgEntity(r,i)),i},t.prototype.isTapEnabled=function(){return!0},t}(it),ur=function(i){function r(n){var t=this,r={};return t=i.call(this,r)||this,r.defineProperty("tempName"),r.defineProperty("tempDescription"),r.defineProperty("topPosition"),r.defineProperty("leftPosition"),r.defineProperty("rightPosition"),r.defineProperty("messageText"),t.controlTemplateFactory=n,t._templateName=wi,t.disposables=[],t.resources=a,t._dataManager=new vt,t.finished=new k,t}return b(r,i),r.prototype.setEntityData=function(n){this._taskState=n;this._primitiveToAdd=y.simplePointFactory(n.data)},r.prototype.setSavingTempCol=function(){this._isSavingTempCollection=!0;this.tempCol=ot.getCollection()},r.prototype.getTitleText=function(n){return n?this.resources.TemporaryCollectionSaveButtonText:this.resources.L_AddCollection_Text},r.prototype.boolToDisplay=function(n){return n?"":"none"},r.prototype.boolToNotDisplay=function(n){return n?"none":""},r.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw new Error("control template factory must be defined.");var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},r.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},r.prototype.AddCollection=function(t,i,r){var e=this,f=new u(u.localCollectionId,t),s,h,l,c,o;for(f.description=i,f.isPublic=!1,this._isSavingTempCollection?this.tempCol&&this.tempCol.primitives.length&&f.primitives.insertAll(this.tempCol.primitives.slice()):this._primitiveToAdd&&f.primitives.insert(this._primitiveToAdd),s=0,h=0;h<f.primitives.length;h++)if(l=f.primitives[h].entity.photoUrl,s<3&&l)f.collageImages.insert(l),s++;else if(s===3)break;if(n.enableOneClickSave&&this._taskState&&this._taskState.removeEntityAndPerformAction&&this._taskState.entityId)if(this._taskState.removeEntityFromCollectionId)this._dataManager.deletePrimitive(this._taskState.removeEntityFromCollectionId,this._taskState.entityId,function(n){n!==0?e.setMessageText(e.resources.L_CollectionError_Adding_Text):e._makeAddCollectionCall(f,r)});else{for(c=void 0,o=0;o<this._dataManager.favorites.length;o++)this._dataManager.favorites[o].entity.id===this._taskState.entityId&&(c=this._dataManager.favorites[o]);c||this.setMessageText(this.resources.L_CollectionError_Adding_Text);this._dataManager.removeFavorite(c,function(n){n!==0?e.setMessageText(e.resources.L_CollectionError_Adding_Text):e._makeAddCollectionCall(f,r)})}else this._makeAddCollectionCall(f,r)},r.prototype.onCancelTitleEditClick=function(n){n.stopPropagation();n.preventDefault();this.setTempName("");this.setTempDescription("");this.finished.invoke(!1);this.dispose()},r.prototype.onConfirmTitleEditClick=function(n){this._validateTitleAndDescription()&&this._createCollection(n);n.stopPropagation();n.preventDefault()},r.prototype.onNameEditBoxClick=function(n){n.stopPropagation();n.preventDefault()},r.prototype._createCollection=function(i){var r=this,u=w(i.target);u.add_class("inactive");this.AddCollection(this.getTempName(),this.getTempDescription(),function(i,f){if(u.has_class("inactive")&&u.remove_class("inactive"),f===0)t.logAction(v.newCollectionSave,{SUCCESS:"True"}),i.primitivesRetrieved=!1,r._dataManager.retrieveCollection(i.id,function(n){r._isSavingTempCollection&&(ot.clearCollection(),r._isSavingTempCollection=!1);n.changed.invoke();r._dataManager.collectionAdded.invoke(!0);r._addConfirmationTip(n.id,n.name);r.finished.invoke(!0);r.dispose()});else{t.logAction(v.newCollectionSave,{SUCCESS:"False",ERR:f});switch(f){case 2:r.setMessageText(r.resources.L_Max_Collections_Message.replace("{0}",n.maxAllowedCollections+""));break;default:r.setMessageText(r.resources.L_CollectionError_Adding_Text)}r.finished.invoke(!1);r.dispose()}})},r.prototype._validateTitleAndDescription=function(){var n=this.getTempName(),t;return n&&(n=n.trim()),t=this.getTempDescription(),n&&n.length!==0?n.length>100?(this.setMessageText(this.resources.L_TitleLengthError_Text),!1):t.length>1e3?(this.setMessageText(this.resources.L_DescLengthError_Text),!1):!0:(this.setMessageText(this.resources.L_CollectionNameMissing_Text),!1)},r.prototype._addConfirmationTip=function(n,t){var e=this,o=[a.NewCollectionConfirmationText.replace("{0}",t)],i=new fi(null,a.NewCollectionConfirmationTitle,o,!0,!0,!1,!0,bi);i.setShowClose(!1);i.disposables.push(i.messageLinkClicked.add(function(){return e._openNewCollection(n)}));var r=i.getRootElement()[0],u=this.getControl(),f=u&&u.length&&u[0].parentElement;f&&r&&(r.style.top=this.getTopPosition(),r.style.left=this.getLeftPosition(),f&&f.appendChild(r))},r.prototype._openNewCollection=function(n){var t={action:gt.ViewCollection,entryPoint:2,collectionId:n},i={type:ii.collectionsTask,state:t};ti.invokeHandler(ni.taskDataHandlerKey,i)},r.prototype._makeAddCollectionCall=function(n,t){var i=this;this._dataManager.retrieveAllCollectionsMetaData(function(){i._dataManager.createCollection(n,t)})},r}(it),fr=function(r){function u(n){var i=this,t={};return i=r.call(this,t)||this,t.defineProperty("showDropdown",function(n,t){return i._onShowPopOutChanged(n,t)}),t.defineProperty("showSaveButton",null,null,{defaultValue:!0}),t.defineProperty("itineraries"),t.defineProperty("collections"),t.defineProperty("entityName"),t.defineProperty("entityAddress"),t.defineProperty("entityId"),t.defineProperty("entityLat"),t.defineProperty("entityLong"),t.defineProperty("entityCatId"),t.defineProperty("entityImage"),t.defineProperty("topPosition"),t.defineProperty("leftPosition"),i.signInState=new ai,i._preventDefaultSave=!1,i.controlTemplateFactory=n,i._templateName=ki,i.disposables=[],i._dataManager=new vt,i._savedText=a.SaveOnSerp_SavedButtonText,i._windowClickEventHandler=function(n){i._hideDropdown(n)},i}return b(u,r),u.prototype.getPreventDefaultClick=function(){return this._preventDefaultSave},u.prototype.setPreventDefaultClick=function(n){this._preventDefaultSave=n},u.prototype.setEntityInformation=function(n){var t,r;if(this._currentEntityState=n,t=n.data,t){this.setEntityName(t.title);r=t.id;switch(t.entityIdType){case 2:r=i.sid+":"+r;break;case 1:default:r=i.ypid+":"+r}this.setEntityId(r);this.setEntityLat(t.location.latitude);this.setEntityLong(t.location.longitude);this.setEntityCatId(t.categoryId);this.setEntityImage(t.photoUrl);this.setEntityAddress(t.address)}},u.prototype.saveOnSerpClicked=function(n,i,r,f){var e=this,o=this.signInState.getIsSignedIn();if(t.logAction(v.SaveOnSerpClick,{SI:o}),o){if(!this._isSaved||i)this.onFavoritesClick(null,function(){e._isSaved=!0;f||e._launchConfirmationTip(r);n&&n(e._savedText)})}else d&&d.isEnabled()&&(d.setItem(u.localStorageKey,JSON.stringify(this._currentEntityState)),i&&d.setItem(u.multiSaveKey,"true")),sj_cook&&sj_cook.set("SRCHUSR","POEX","W",!0,"/"),window.location.assign(this.signInUrl)},u.prototype.saveOnInfoboxClicked=function(n,t,i){var f=this,e,r,u;if(n.preventDefault(),n.stopImmediatePropagation(),e=this.signInState.getIsSignedIn(),e)this.onFavoritesClick(n,function(n){f._isSaved=!0;f._buildCollectionsTaskData(n.entity);i||f._launchConfirmationTip(null,!0);t&&t(f._savedText)});else{this.onTemporaryCollectionClick(n);r=ot.getCollection();r&&r.primitives&&r.primitives.length>0?(u=r.primitives[0].entity,u&&this._buildCollectionsTaskData(u,!1)):(u={name:this.getEntityName(),id:this.getEntityId(),photoId:this.getEntityImage(),address:this.getEntityAddress(),routableLocation:new l(this.getEntityLat(),this.getEntityLong())},this._buildCollectionsTaskData(u,!1));i||this._launchConfirmationTip(null,!0);t&&t(this._savedText)}},u.prototype.saveOnSerpMouseEnter=function(){var t=w(".b_wftp"),i,r,u,n,f;t&&(i=t.select(".wfr_grid"),r=t.select("a.b_saveOnLocal"),i.length&&r.length&&(u=i[0],n=r[0],this.setLeftPosition(n.offsetLeft+n.offsetWidth/2+u.offsetLeft),this.setTopPosition(n.offsetTop+n.offsetHeight+4+u.offsetTop)));this._isSaved?this._launchConfirmationTip():(f=w("bm_save_overlay").select("a.b_saveOnLocal"),f.length===0&&this._showHoverTip())},u.prototype.saveOnSerpMouseLeave=function(){var n=this;this._isSaved?this._hoverTimeout=Microsoft.Maps.setTimeout(function(){n.confirmationTip&&n.confirmationTip.removeTip()},100):this.hoverTip&&this.hoverTip.removeTip()},u.prototype.checkSignInSave=function(n){var r=d&&d.isEnabled()&&d.getItem(u.localStorageKey),i,t;r&&this.signInState.getIsSignedIn()&&(this.setEntityInformation(JSON.parse(r)),i=d.getItem(u.multiSaveKey),t=!1,i&&(t=i==="true"),this.saveOnSerpClicked(t?null:n,t,null,t),d.removeItem(u.localStorageKey))},u.prototype.boolToDisplay=function(n){return n?"":"none"},u.prototype.boolToNotDisplay=function(n){return n?"none":""},u.prototype.collectionIdToDisplayNone=function(i){return n.useJsonApiForFavorites&&t.isDefaultCollectionId(i)?"display:none":""},u.prototype.fetchItineraries=function(){var n=this;this._dataManager.retrieveAllItinerariesMetaData(function(t){t&&n.setItineraries(t)})},u.prototype.fetchCollections=function(){var n=this;this._dataManager.retrieveAllCollectionsMetaData(function(t){t&&t.collections&&n.setCollections(t.collections)})},u.prototype.getControl=function(){if(!this._control){if(!this.controlTemplateFactory)throw new Error("control template factory must be defined.");var n=this.controlTemplateFactory({templateText:this._templateName,staticResources:this});this._control=n.applyDataTemplate(this);this.disposables.push(n)}return this._control},u.prototype.dispose=function(){for(var n=0;n<this.disposables.length;n++)this.disposables[n].dispose();this.disposables=[]},u.prototype.onSaveClick=function(n){this.getPreventDefaultClick()||(this.setShowDropdown(!0),n.stopPropagation(),n.preventDefault())},u.prototype.onItineraryClick=function(n){var u=this,t,r,e,o;if(n){n.stopPropagation();n.preventDefault();var s=n.currentTarget,f=s.attributes["data-entityId"],i=f&&f.value;for(t=0,r=this.getItineraries();t<r.length;t++)e=r[t],o={Name:this.getEntityName(),Id:this.getEntityId(),Lat:this.getEntityLat(),Lon:this.getEntityLong(),StayDuration:"",InterestTypes:[],Image:{Url:this.getEntityImage()},CategoryId:this.getEntityCatId()},e.collectionId===i&&this._dataManager.retrieveItinerary(i,function(n,t){n&&t===0&&u._dataManager.addItineraryItem(i,new dt(o,0,0),function(){u.setShowDropdown(!1)})})}},u.prototype.onCollectionClick=function(n){var u=this,t,r,e;if(n){n.stopPropagation();n.preventDefault();var o=n.currentTarget,f=o.attributes["data-entityId"],i=f&&f.value,s=y.simplePointFactory({title:this.getEntityName(),id:this.getEntityId(),categoryId:this.getEntityCatId(),location:new l(this.getEntityLat(),this.getEntityLong()),photoUrl:this.getEntityImage()});for(t=0,r=this.getCollections();t<r.length;t++)e=r[t],e.id===i&&this._dataManager.retrieveCollection(i,function(n,t){n&&t===0&&u._dataManager.addPrimitive(i,s,function(){u.setShowDropdown(!1)})})}},u.prototype.onTemporaryCollectionClick=function(n,t){var i,r,u;t===void 0&&(t=!1);n&&(n.stopPropagation(),n.preventDefault(),i=y.simplePointFactory({title:this.getEntityName(),id:this.getEntityId(),categoryId:this.getEntityCatId(),location:new l(this.getEntityLat(),this.getEntityLong()),photoUrl:this.getEntityImage()}),r=Math.floor(Math.random()*1e3)+"_"+Math.floor(Math.random()*1e3),i.entity.id=r,t?(u=ot.getCollection(),u.primitives.find(function(n){return n.id===i.id})||ot.addPoint(i)):ot.addPoint(i),this.setShowDropdown(!1))},u.prototype.onFavoritesClick=function(n,t){var i=this;n&&(n.stopPropagation(),n.preventDefault());this._dataManager.syncFavorites(function(n){var e,s;if(n===0){var u=i.getEntityLat(),f=i.getEntityLong(),o=i.getEntityName(),r=new st;r.entity=new kt;r.entity.setOriginalName(o);r.entity.setName(o);r.entity.categoryId=i.getEntityCatId();r.entity.setAddress(i.getEntityAddress());e=i.getEntityId();e&&r.entity.setBusinesslistingid(e);r.entity.setPhotoUrl(i.getEntityImage());r.setGeometry({x:f,y:u,bounds:[u,f,u,f]});s=function(n){i.setShowDropdown(!1);t&&t(n)};i._dataManager.createFavorite(r,s,2)}})},u.prototype.saveRootClass=function(n){return"bm_saveRoot"+(n?"":" noButton")},u.prototype._onShowPopOutChanged=function(n,t){var r=this,i=w(window);t?Microsoft.Maps.setTimeout(function(){i.add_event("click,contextmenu",r._windowClickEventHandler)},1):n&&i.remove_event("click,contextmenu",this._windowClickEventHandler)},u.prototype._hideDropdown=function(){this.getShowDropdown()?this.setShowDropdown(!1):w(window).remove_event("click,contextmenu",this._windowClickEventHandler)},u.prototype._launchConfirmationTip=function(n,t){var r=this,i=new li(a.SaveOnSerp_SavedButtonText,a.SaveOnSerp_ConfirmationLink),u=i.getRootElement(),f;this.disposables.push(i.tipRemoved.add(function(){r.confirmationTip=null;n&&n()}));this.disposables.push(i.tipHovered.add(function(){window.clearTimeout(r._hoverTimeout)}));this.disposables.push(i.messageLinkClicked.add(function(){if(r.confirmationTip.removeTip(),t){var n=r._taskOptions;n&&ti.invokeHandler(ni.taskDataHandlerKey,n)}else sj_evt.fire("ShowSaveMapOverlay")}));this._control.append(u);u.set_style({top:this.getTopPosition()+6,left:this.getLeftPosition()-u[0].offsetWidth/2});f=w(".tooltipsLink",u[0]);f.length&&f[0].focus();this.confirmationTip&&this.confirmationTip.removeTip();this.confirmationTip=i},u.prototype._showHoverTip=function(){var i=this,n=new fi(null,null,[a.SaveOnSerp_HoverTip],!0,!0,!0,!1),t;n.setShowBeak(!0);n.setShowClose(!1);t=n.getRootElement();this.disposables.push(n.tipRemoved.add(function(){i.hoverTip=null}));this._control.append(t);t.set_style({top:this.getTopPosition()+6,left:this.getLeftPosition()-t[0].offsetWidth/2});this.hoverTip&&this.hoverTip.removeTip();this.hoverTip=n},u.prototype._buildCollectionsTaskData=function(n,t){t===void 0&&(t=!0);var i={};i.action=t?gt.ViewFavorites:gt.ShowTemporaryCollection;i.entityId=n.id;i.entryPoint=14;this._taskOptions={action:"activate",type:ii.collectionsTask,state:i}},u.localStorageKey="MyPlacesSaveOnSerp",u.multiSaveKey="MultiEntitySaveOnSerp",u}(it),ot=function(){function i(){}return i.addPoint=function(t){if(i._temporaryCollectionEnabled()){i.temporaryCollection&&i.syncedFromStorage||i.getCollection();var r=i._findExistingPoint(t.entity.id);return r===-1?(i.temporaryCollection.primitives.insert(t),i.commitChanges(),n.enableOneClickSave&&ut.instance.pushCollection(i.temporaryCollection),0):12}return 1},i.removePoint=function(n){if(i._temporaryCollectionEnabled()){var t=i._findExistingPoint(n);t!==-1&&i.temporaryCollection.primitives.removeAt(t);i.commitChanges()}},i.updatePoint=function(n,t,r){var f,u;i._temporaryCollectionEnabled()&&(f=i._findExistingPoint(n),f!==-1&&(u=i.temporaryCollection.primitives[f],u.entity.name=t,u.entity.description=r,u.changed.invoke(),i.temporaryCollection.primitives.changed.invoke()),i.commitChanges())},i.getCollection=function(){if(i._temporaryCollectionEnabled()){if(i.temporaryCollection||i._resetTemporaryCollection(),!i.syncedFromStorage){var r=d.getItem(i.collectionsLocalStorageKey),t=JSON.parse(r),f=t&&t.$type==="GeoAnnotationsCollection",n=u.deserialize(t,f);n&&n.primitives&&(i.temporaryCollection.primitives=n.primitives,this._buildImageCollageForTempCollection(n.primitives));i.syncedFromStorage=!0}return i.temporaryCollection}return null},i.commitChanges=function(){if(i._temporaryCollectionEnabled()){var n=JSON.stringify(u.serialize(i.temporaryCollection,!0));d.setItem(i.collectionsLocalStorageKey,n)}},i.clearCollection=function(){i._temporaryCollectionEnabled()&&(n.enableOneClickSave&&ut.instance.removeCollection(i.temporaryCollection),d.removeItem(i.collectionsLocalStorageKey),i._resetTemporaryCollection())},i.logTemporaryCollection=function(){if(i._temporaryCollectionEnabled()&&!i.alreadyLogged){var f=d.getItem(i.collectionsLocalStorageKey),n=JSON.parse(f),e=n&&n.$type==="GeoAnnotationsCollection",r=u.deserialize(n,e);r&&r.primitives&&t.logAction(v.temporaryCollectionStatus,{ENT:r.primitives.length});i.alreadyLogged=!0}},i._resetTemporaryCollection=function(){i.temporaryCollection?(i.temporaryCollection.primitives.clear(),i.temporaryCollection.description=""):i.temporaryCollection=new u("TEMP",a.L_TemporaryCollectionTitle)},i._temporaryCollectionEnabled=function(){return et.isMapsVertical&&d.isEnabled()},i._findExistingPoint=function(n){var r,u,t;if(i.temporaryCollection)for(r=i.temporaryCollection.primitives,u=r?r.length:0,t=0;t<u;t++)if(r[t].entity.id===n)return t;return-1},i._buildImageCollageForTempCollection=function(n){for(var t,r=new c,u=0;u<n.length;u++)t=n[0],t.Image&&r.insert(t.Image);i.temporaryCollection.collageImages=r},i.collectionsLocalStorageKey="BingMapsUserCollections",i.maxLimit=100,i.temporaryCollection=new u("TEMP",a.L_TemporaryCollectionTitle),i.syncedFromStorage=!1,i.alreadyLogged=!1,i}();f.ServerRequestFactory=o;f.AutoCollectionGenerator=di;f.Collection=u;f.CollectionConstants=i;f.CollectionEntity=s;f.CollectionLogActionName=v;f.CollectionsDataManager=ht;f.CollectionsLocalStorageHelper=ot;f.EventEntity=ri;f.FavoriteEntity=kt;f.FavoritePoint=st;f.FlightEntity=ei;f.Itinerary=rt;f.ItineraryConverter=nt;f.ItineraryDataManager=vt;f.ItineraryItem=dt;f.ItineraryRequestFactory=tt;f.MostRecentlyUsedList=ut;f.MyPlaces=bt;f.NewCollectionControl=ur;f.PerfEventNames=gi;f.Polygon=lt;f.Polyline=at;f.SaveDropdownControl=fr;f.SimplePoint=y;f.Utilities=t}catch(si){if(r.logger)r.logger.logCriticalError(si);else throw si;}}).call(window)